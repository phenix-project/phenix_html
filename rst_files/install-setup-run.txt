============================
How to set up and use Phenix
============================

.. contents::

Installation
============

Chatbot help on installation
----------------------------


You can use the Phenix `chatbot <reference/chatbot.html>`__
to help you with installation.



Platform support
----------------

Phenix is supported on most common Linux platforms (glibc 2.17 or newer),
macOS version 10.13 or newer for Intel and 11 or newer for Apple Silicon,
and Windows 10 or newer.

Space requirements
-------------------

For the complete Phenix installation you will need approximately 15 GB
of disk space. During installation, you will need approximately 25 GB
for temporary files.

Graphical installer - Mac
-------------------------

There are installers for Intel processors and for Apple Silicon processors.
Choose the installer that matches the hardware on your system. Apple
Silicon installers will not run on Intel systems and the Intel version of
Phenix will run significantly slower on Apple Silicon systems.

After downloading the Phenix-xxxx.pkg file use "Open with" and choose
"Installer.app". When asked about unknown applications go ahead and hit Open
(if you just double-click on the file it will say that it is not approved
by Apple and it will not give you the option to approve it yourself). On
newer versions of macOS, you will get a message that the installer cannot
be run. You must then go to System Preferences, and then Privacy & Security.
At the bottom, you will get an option to run the .pkg installer anyway.
Click that to run the installer.

Alternatively, you can run ``xattr -c <GUI installer name>``, to skip
the security checks by macOS.

You will need administrative privileges to install Phenix into **/Applications**.
For single user installation, the default location is in **${HOME}/Applications**.
The Phenix application is found inside the Phenix-<version> folder in those
directories.

Graphical installer - Windows
-----------------------------

Run the .exe installer and follow the prompts. Windows may have similar
security prompts like in macOS. Click "More info" and then "Run anyway"
to run the installer.

The destination folder should be a path without spaces.

There will be a new Start Menu folder containing the Phenix GUI application
and an item for starting a command-line prompt with the Phenix environment.

Command-line installer (macOS and Linux)
----------------------------------------

On macOS and Linux, the command-line installers are packaged as ``.sh``
files. To install, run

  ``% bash <installer name>``

for interactive installations. For batch mode (skips interactive prompts), run

  ``% bash <installer name> -b -p <prefix>/phenix-<version>``

The ``phenix-<version>`` is needed to isolate the Phenix installation from
``<prefix>``.

Installation time
-----------------

Installation of the binary version of Phenix requires no compilation, only
the extraction of compressed packages and then the generation of some data
files. You will probably have to wait about 15 minutes for the installation
to complete, depending on the performance of your installation platform.
However, installation may take upwards of 30 minutes or more if you have
antivirus software or slow disk speeds.


Running Phenix
==============

If you intend to use the graphical interface and installed Phenix using the
macOS or Windows graphical installers, no further configuration is necessary -
just double-click the icon for the main Phenix GUI.  Instructions below are
for users of the command-line installer and/or programs.

Setting up the command-line environment
---------------------------------------

Once you have successfully installed Phenix, to set up your environment
please source the ``phenix_env`` file in the Phenix installation directory
(for example - replace "<version>" with the actual installed version,
such as "2.0-5933"):

    ``% source <prefix>/phenix-<version>/phenix_env.sh`` for sh users

    ``% source <prefix>/phenix-<version>/phenix_env.csh`` for csh users

To simplify the set up of Phenix, you can add this step to your shell
startup script.

If you used the graphical Mac installer, you can find the files in the
phenix-<version> folder in /Applications or ${HOME}/Applications.

The following environmental variables should now be defined (here with
example values)::

   PHENIX=<installation location>
   PHENIX_PREFIX=<installation location>
   PHENIX_VERSION=<version>

The ``$PATH`` is also updated to put Phenix executables before your other
commands.

Documentation
-------------

You can find documentation in the Phenix GUI (under the Help menu).
Alternatively, you can use a web browser to view the documentation
supplied with Phenix, by typing:

    ``% phenix.doc``

If this does not work because of browser installation issues then you can
point a web browser to the correct location in your Phenix installation
(for example):

    ``% firefox ${PHENIX_PREFIX}/share/phenix/doc/index.html``

For license information please see the LICENSE file.

For the source of the components see SOURCES.

Help
----

You can join the Phenix bulletin board and/or view the archives:

::

    https://phenix-online.org/mailman3/lists/phenixbb.phenix-online.org/

Alternatively you can send email to:

::

    help@phenix-online.org  (if you'd like to ask us questions or report bugs)

User interfaces
===============

Different user interfaces are required depending on the needs of a
diverse user community.  Most modules in Phenix can be run either through
a graphical user interface (GUI) or as command-line programs.
For new users (and those without experience
with Unix/Linux systems), we recommend using the graphical interface.

The Phenix GUI
--------------

For new users and anyone unfamiliar with Unix command lines, we recommend
using the graphical interface.  To run, simply type this command:

::

    % phenix &

Please see the other documentation files to get more details about the
`Phenix GUI <phenix_gui.html>`__.

Command Line Interface
----------------------

Advanced users (or anyone developing automated pipelines) may prefer to use
the command-line interface.
This is particularly the case when rapid results are required, such as
data quality assessment and twinning analysis, or substructure solution
at the synchrotron beam line. Tools that facilitate the ease of use at
the early stages of structure solution, such as data analyses
(phenix.xtriage), substructure solution (phenix.hyss) and reflection
file manipulations such as the generation of a test set, reindexing and
merging of data (phenix.reflection_file_converter) are available via
simple command line interfaces.  Most of the larger programs such as
phenix.refine and the AutoSol, AutoBuild, and LigandFit wizards are also
available as command-line tools.

To illustrate the command line interface, the command used to run the
program that carries out a data quality and twinning analyses is:

  ``phenix.xtriage my_data.sca [options]``

Further options can be given on the command line, or can be specified
via a parameter file:

  ``phenix.xtriage my_parameters.def``

A similar interface is used for macromolecular refinement:

  ``phenix.refine my_model.pdb my_data.mtz``

Although SCALEPACK and MTZ formats are indicated in the above example,
reflection file formats such as D\*TREK, CNS/XPLOR or SHELX can be used,
as the format is detected automatically.

Help for all command line applications can be obtained by use of the
flag --help :

  ``phenix.refine --help``

There are also many other command line tools (described in detail
elsewhere in this documentation). You can list them all with

  ``phenix.list``

or alternatively,

  ``phenix.list ave``

to list all methods that contain the characters ave in their names or
descriptions.

Note: all commands have their regular name and name qualified with the
version. You can always use the version-qualified name to ensure which
version of a command you are using (in case you have multiple versions
of Phenix or related applications installed).

The runtime options for most Phenix tools are controlled using a lightweight
syntax called PHIL (Python Hierarchial Interface Language), which is designed
to work both as command-line arguments or as more verbose parameter files.
A basic overview of PHIL is available in the `overview of file formats
<file_formats.html#phil>`__.

Troubleshooting
===============

Problems installing on Linux
----------------------------

The command-line installer extracts some files into the temporary
directory and then runs those files. On systems where the temporary
directory is mounted to be non-executable, you will have to provide
an alternate temporary directory. To do so, prepend the TMPDIR environment
variable to the installation command.

  ``TMPDIR=<executable temporary directory> bash <installer name>``
