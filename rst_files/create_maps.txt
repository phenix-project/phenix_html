==================================
Creating maps using the Phenix GUI
==================================

Because of the differences in calculation method and input data, there is no
single unified interface for creating any electron density maps; instead,
separate programs are grouped together in the main GUI.  For omit maps, a
modified interface to `AutoBuild <autobuild.htm>`_ is available; consult the
AutoBuild documentation for rules on use.  Isomorphous difference maps have a
separate GUI, which takes two reflection files as input.  For maps using
phases from a model, use ``phenix.create_maps``.  All of these programs
write output as an MTZ file; the latter two may optionally output XPLOR maps
(calculated to cover the PDB file used for phasing) if desired.

The "Create Maps" GUI
---------------------

The interface for calculating electron density maps uses the same code base
as the `validation tools <validation.htm>`_ and consequently has a similar
interface.  The primary difference is the ability to request arbitary map
types, including user-defined difference maps.  The window shown below has
the default maps entered: 2mFo-DFc and mFo-DFc difference maps.

.. image:: images/map_types.png

The pre-defined maps include all common likelihood-weighted difference maps,
anomalous difference map, and likelihood-weighted F(obs) or F(calc) maps.
Custom map types can be defined by typing in an appropriate string in a
format similar to those already shown; the map generator will parse the
string to determine the components used.

If the "Save maps in XPLOR format" box is checked, maps suitable for display
in PyMOL will be generated.  You may define custom maps, using the same
map type syntax as for MTZ format, but with additional control over the
region covered by the map and the grid scale.  If no additional XPLOR maps
are requested, Phenix will simply convert any map coefficients from the MTZ
file to XPLOR format (covering the input molecule plus a buffer region).

Guidelines for use
------------------

  - "Kicked" maps use small random perturbations in coordinates to reduce
    model bias and noise; the final map is an average of independently
    calculated perturbed maps.  This adds to calculation time, but is
    considerably faster than a composite omit map.

  - Map quality may be heavily influenced by reflections that are missing due
    to errors in data collection or processing.  Substituting F(calc) for
    missing F(obs) increases model bias but often results in a more easily
    interpreted map; the default maps output by ``phenix.refine`` (and
    REFMAC) are "filled" maps.  In ``phenix.create_maps``, the default maps
    are filled, and we recommend using this option unless you are particularly
    worried about model bias.

  - Output MTZ column labels must be unique; the predefined map types have
    associated predefined labels, but you can change these if you wish.

  - Anomalous difference maps require anomalous data (i.e. F+,F- or
    I+,I-); the precalculated anomalous difference DANO generated by some
    CCP4 programs is not suitable.

  - If you are using neutron data, set the scattering table to "neutron";
    otherwise, leave it set to "n_gaussian".
