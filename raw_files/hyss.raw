<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Hybrid Substructure Search</U></H4>


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here.
Anything enclosed in header html H4 H5 etc will go in the table of contents>
<P><H5><U><B>HySS overview</B></U></H5><P>
<p>The HySS (Hybrid Substructure Search) submodule of the Phenix package
is a highly-automated procedure for the location of anomalous
scatterers in macromolecular structures. HySS starts with the
automatic detection of the reflection file format and analyses all
available datasets in a given reflection file to decide which of these
is best suited for solving the structure. The search parameters are
automatically adjusted based on the available data and the number of
expected sites given by the user. The search method is a systematic
multi-trial procedure employing</p>
<blockquote>
<ul>
<li>direct-space Patterson interpretation followed by</li>
<li>reciprocal-space Patterson interpretation followed by</li>
<li>dual-space direct methods followed by</li>
<li>automatic comparison of the solutions and</li>
<li>automatic termination detection.</li>
</ul>
</blockquote>
<p>The end result is a <em>consensus model</em> which is exported in a variety of
file formats suitable for frequently used phasing and density
modification packages.</p>
<p>Links:</p>
<blockquote>
<ul>
<li><a class="reference" href="examples.html">Examples</a></li>
<li><a class="reference" href="http://www.phenix-online.org/download/cci_apps/">Download page</a></li>
</ul>
</blockquote>
<p>The core search procedure is applicable to both anomalous diffraction
and isomorphous replacement problems. However, currently the command
line interface is limited to work with anomalous diffraction data
or <em>externally</em> preprocessed difference data.</p>
<p>References:</p>
<blockquote>
<ul>
<li>Grosse-Kunstleve RW, Adams PD: <br />
<strong>Substructure search procedures for macromolecular structures</strong> <br />
<a class="reference" href="http://journals.iucr.org/d/issues/2003/11/00/ba5048/">Acta Cryst. 2003, D59, 1966-1973.</a> <br />
<a class="reference" href="http://cci.lbl.gov/~rwgk/my_papers/iucr/ba5048_reprint.pdf">Electronic reprint</a></li>
<li>Adams PD, Grosse-Kunstleve RW, Hung L-W, Ioerger TR, McCoy AJ,
Moriarty NW, Read RJ, Sacchettini JC, Sauter NK, Terwilliger, TC: <br />
<strong>PHENIX: building new software for automated crystallographic
structure determination</strong> <br />
<a class="reference" href="http://journals.iucr.org/d/issues/2002/11/00/ba5027/">Acta Cryst. 2002, D58, 1948-1954.</a> <br />
<a class="reference" href="http://cci.lbl.gov/~rwgk/my_papers/iucr/ba5027_reprint.pdf">Electronic reprint</a></li>
</ul>
</blockquote>
<p>To contact us send email to <a class="reference" href="mailto:help&#64;phenix-online.org">help&#64;phenix-online.org</a> or
<a class="reference" href="mailto:bugs&#64;phenix-online.org">bugs&#64;phenix-online.org</a>.</p>
<P><H5><U><B>HySS examples</B></U></H5><P>
<p>The only input file required for running HySS is a file with the
reflection data. HySS reads the following formats directly:</p>
<blockquote>
<ul>
<li>merged scalepack files</li>
<li>unmerged scalepack files (but merged files are preferred!)</li>
<li>CCP4 MTZ files with merged data</li>
<li>CCP4 MTZ files with unmerged data (but merged files are preferred!)</li>
<li>d*trek .ref files</li>
<li>XDS_ASCII files with merged data</li>
<li>CNS reflection files</li>
<li>SHELX reflection files with amplitudes</li>
</ul>
</blockquote>
<P><H5><U><B>nsf_d2_peak.sca</B></U></H5><P>
<p>The <a class="reference" href="http://www.phenix-online.org/download/cci_apps/">CCI Apps binary bundles</a> include a scalepack file with anomalous
peak data for the structure with the PDB access code <a class="reference" href="http://www.rcsb.org/pdb/cgi/explore.cgi?pdbId=1NSF">1NSF</a> (courtesy
of A.T.  Brunger). To find the 8 selenium sites enter:</p>
<pre class="literal-block">
phenix.hyss nsf_d2_peak.sca 8 se
</pre>
<p>This leads to:</p>
<pre class="literal-block">
Reading reflection file: nsf_d2_peak.sca

Space group found in file: P 6
Is this the correct space group? [Y/N]:
</pre>
<p>HySS prompts for a confirmation of the space group because space group
P6 is often used as a placeholder during data reduction. If the space
group symbol found in the reflection file is not correct it can be
changed. However, in this case the symbol is correct. At the prompt
enter <tt class="docutils literal"><span class="pre">Y</span></tt> to continue. Alternatively, the interactive prompt can be
avoided by using the <tt class="docutils literal"><span class="pre">--space_group</span></tt> option:</p>
<pre class="literal-block">
phenix.hyss nsf_d2_peak.sca 8 se --space_group=p6
</pre>
<p>HySS will quickly print a few screen-pages with information about
the data (e.g. the magnitude of the anomalous signal) and the
many search parameters. The most interesting output is produced
after this point:</p>
<pre class="literal-block">
Entering search loop:

p = peaklist index in Patterson map
f = peaklist index in two-site translation function
cc = correlation coefficient after extrapolation scan
r = number of dual-space recycling cycles
cc = final correlation coefficient

p=000 f=000 cc=0.364 r=015 cc=0.479 [ best cc: 0.479 ]
p=000 f=001 cc=0.310 r=015 cc=0.477 [ best cc: 0.479 0.477 ]
Number of matching sites of top 2 structures: 11
p=000 f=002 cc=0.166 r=015 cc=0.479 [ best cc: 0.479 0.479 0.477 ]
Number of matching sites of top 2 structures: 11
Number of matching sites of top 3 structures: 11
</pre>
<p>It will take a few seconds for each line starting with <tt class="docutils literal"><span class="pre">p=</span></tt> to
appear. Each of these lines summarizes the result of one trial
consisting of an evaluation of the Patterson function, two fast
translation functions, and 15 cycles of dual-space recycling. The
important number to watch is the <tt class="docutils literal"><span class="pre">final</span> <span class="pre">correlation</span></tt>.  In the first
three trials HySS finds three substructure models with promisingly high
correlations. These models are compared, taking allowed origin shifts
and the hand ambiguity into account.  The three models have more than
2/3 of the expected number of sites in common. Therefore HySS decides
that the search is complete and prints a summary of the matching
sites:</p>
<pre class="literal-block">
Top 3 correlations:
p=000 f=000 cc=0.364 r=015 cc=0.479
p=000 f=002 cc=0.166 r=015 cc=0.479
p=000 f=001 cc=0.310 r=015 cc=0.477
Match summary:
  Operator:
       rotation: {{-1.0, 0.0, 0.0}, {0.0, -1.0, 0.0}, {0.0, 0.0, -1.0}}
    translation: (-9.6289517721653785e-38, 0.0, 0.091526465343537006)
  rms coordinate differences: 0.06
  Pairs: 11
    site001 site001 0.018
    site002 site002 0.056
    site003 site003 0.033
    site004 site004 0.026
    site005 site005 0.050
    site006 site006 0.103
    site007 site007 0.040
    site008 site008 0.063
    site009 site010 0.067
    site010 site009 0.120
    site011 site011 0.029
  Singles model 1: 0
  Singles model 2: 0
</pre>
<p>The matching sites are used to build a <em>consensus model</em>. The
coordinates and occupancies are quickly refined using a quasi-Newton
minimizer:</p>
<pre class="literal-block">
Minimizing consensus model (11 sites).
Truncating consensus model to expected number of sites.
Minimizing consensus model (8 sites).
Correlation coefficient for consensus model (8 sites): 0.483
</pre>
<p>The refined sites are sorted by occupancy in descending order. The
model is truncated to the expected number of sites and refined again.
After printing detailed timing information (not shown) the output
ends with:</p>
<pre class="literal-block">
Storing all substructures found: nsf_d2_peak_hyss_models.pickle

Storing consensus model: nsf_d2_peak_hyss_consensus_model.pickle

Writing consensus model as PDB file: nsf_d2_peak_hyss_consensus_model.pdb

Writing consensus model as CNS SDB file: nsf_d2_peak_hyss_consensus_model.sdb

Writing consensus model as SOLVE xyz records: nsf_d2_peak_hyss_consensus_model.xyz
The fractional coordinates may also be useful in other programs.

Total CPU time: 49.60 seconds
</pre>
<p>The resulting coordinate files can be used for phasing and density
modification with other programs.</p>
<P><H5><U><B>gere_MAD.mtz</B></U></H5><P>
<p>The <a class="reference" href="http://www.ccp4.ac.uk/">CCP4</a> distribution includes a four-wavelength MAD dataset in the
tutorial directory. To find the 12 selenium sites with HySS enter:</p>
<pre class="literal-block">
phenix.hyss $CEXAM/tutorial2000/data/gere_MAD.mtz 12 se
</pre>
<p>HySS automatically picks the wavelength with the strongest anomalous
signal and finishes after about 34 seconds (2.8GHz Pentium 4 Linux),
writing out the 12 (or sometimes only 11) sites in the various file
formats.</p>
<P><H5><U><B>mbp.hkl</B></U></H5><P>
<p>The <a class="reference" href="http://cns.csb.yale.edu/">CNS</a> tutorial includes data from a MAD experiment with Ytterbium as
the anomalous scatterer. CNS reflection files do not contain
information about the unit cell and space group. However, HySS is able
to extract this information from other files, e.g. other reflection
files, CNS files, SOLVE files, PDB files or SHELX files. For example:</p>
<pre class="literal-block">
phenix.hyss $CNS_SOLVE/doc/html/tutorial/data/mbp/mbp.hkl 4 yb --symmetry $CNS_SOLVE/doc/html/tutorial/data/mbp/def
</pre>
<p>HySS reads the reflection data from the <tt class="docutils literal"><span class="pre">mbp.hkl</span></tt> file. The
<tt class="docutils literal"><span class="pre">--symmetry</span></tt> options instructs HySS to scan the <tt class="docutils literal"><span class="pre">def</span></tt> file
for unit cell parameters and a space group symbol. HySS
finishes after about 26 seconds (2.8GHz Pentium 4 Linux).</p>
<P><H5><U><B>Command line options</B></U></H5><P>
<p>Enter <tt class="docutils literal"><span class="pre">phenix.hyss</span></tt> without arguments to obtain a list of the available
command line options:</p>
<pre class="literal-block">
Command line arguments:

usage: phenix.hyss [options] reflection_file n_sites element_symbol

options:
  -h, --help            show this help message and exit
  --unit_cell=10,10,20,90,90,120|FILENAME
                        External unit cell parameters
  --space_group=P212121|FILENAME
                        External space group symbol
  --symmetry=FILENAME   External file with symmetry information
  --chunk=n,i           Number of chunks for parallel execution and index for
                        one process
  --search=fast|full    Search mode
  --resolution=FLOAT    High resolution limit (minimum d-spacing, d_min)
  --low_resolution=FLOAT
                        Low resolution limit (maximum d-spacing, d_max)
  --site_min_distance=FLOAT
                        Minimum distance between substructure sites (default:
                        3.5)
  --site_min_distance_sym_equiv=FLOAT
                        Minimum distance between symmetrically-equivalent
                        substructure sites (overrides --site_min_distance)
  --site_min_cross_distance=FLOAT
                        Minimum distance between substructure sites not
                        related by symmetry (overrides --site_min_distance)
  --molecular_weight=FLOAT
                        Molecular weight
  --solvent_content=FLOAT
                        Solvent content (default: 0.55)
  --random_seed=INT     Seed for random number generator
  --real_space_squaring
                        Use real space squaring (as opposed to the tangent
                        formula)
  --data_label=STRING   Substring of reflection data label

See also:
  http://www.phenix-online.org/download/documentation/cci_apps/hyss/

Example: phenix.hyss w1.sca 66 Se
</pre>
<p>The <tt class="docutils literal"><span class="pre">--data_label</span></tt>, <tt class="docutils literal"><span class="pre">--resolution</span></tt> and <tt class="docutils literal"><span class="pre">--low_resolution</span></tt> options
can be used to override the automatic selection of the reflection data
and the resolution range. For example, one may enter the following
command with the goal to instruct HySS to use the peak data in the
<tt class="docutils literal"><span class="pre">gere_MAD.mtz</span></tt> file (instead of the inflection point data), and to
set the high resolution limit to 5 Angstrom:</p>
<pre class="literal-block">
phenix.hyss gere_MAD.mtz 12 se --data_label=peak --resolution=5
</pre>
<p>Output:</p>
<pre class="literal-block">
Command line arguments: gere_MAD.mtz 12 se --data_label=peak --resolution=5

Reading reflection file: gere_MAD.mtz

Ambiguous --data_label=peak

Possible choices:
  5: gere_MAD.mtz:FSEpeak,SIGFSEpeak,DSEpeak,SIGDSEpeak,merged
  6: gere_MAD.mtz:F(+)SEpeak,SIGF(+)SEpeak,F(-)SEpeak,SIGF(-)SEpeak

Please specify an unambiguous substring of the target label.

Sorry: Please try again.
</pre>
<p>That's a good first try but if <tt class="docutils literal"><span class="pre">--data_label=peak</span></tt> turns out to be
ambiguous HySS will ask for more information. Second try:</p>
<pre class="literal-block">
phenix.hyss gere_MAD.mtz 12 se --data_label=&quot;F(+)SEpeak&quot; --resolution=5
</pre>
<p>Now HySS will actually perform the search. Typically the search
finishes in less than 10 seconds finding 8-12 sites, depending on the
random number generator (which is seeded with the current time unless
the <tt class="docutils literal"><span class="pre">--random_seed</span></tt> option is used).</p>
<p>The <tt class="docutils literal"><span class="pre">--site_min_distance</span></tt>, <tt class="docutils literal"><span class="pre">--site_min_distance_sym_equiv</span></tt>, and
<tt class="docutils literal"><span class="pre">--site_min_cross_distance</span></tt> options are available to override the
default minimum distance of 3.5 Angstroms between substructure sites.</p>
<p>The <tt class="docutils literal"><span class="pre">--real_space_squaring</span></tt> option can be useful for large structures
with high-resolution data. In this case the large number of triplets
generated for the reciprocal-space direct methods procedure (i.e. the
tangent formula) may lead to excessive memory allocation. By default
HySS switches to real-space direct methods (i.e. E-map squaring) if it
searches for more than 100 sites. If this limit is too high given the
available memory use the <tt class="docutils literal"><span class="pre">--real_space_squaring</span></tt> option. For
substructures with a large number of sites it is in our experience not
critical to employ reciprocal-space direct methods.</p>
<p>If the <tt class="docutils literal"><span class="pre">--molecular_weight</span></tt> and <tt class="docutils literal"><span class="pre">--solvent_content</span></tt> options are
used HySS will help in determining the number of substructures sites in
the unit cell, interpreting the number of sites specified on the
command line as number of sites per molecule. For example:</p>
<pre class="literal-block">
phenix.hyss gere_MAD.mtz 2 se --molecular_weight=8000 --solvent_content=0.70
</pre>
<p>This is telling HySS that we have a molecule with a molecular weight
of 8 kD, a crystal with an estimated solvent content of 70%, and that
we expect to find 2 Se sites per molecule. The HySS output will now
show the following:</p>
<pre class="literal-block">
#---------------------------------------------------------------------------#
| Formula for calculating the number of molecules given a molecular weight. |
|---------------------------------------------------------------------------|
| n_mol = ((1.0-solvent_content)*v_cell)/(molecular_weight*n_sym*.783)      |
#---------------------------------------------------------------------------#
Number of molecules: 6
Number of sites: 12
Values used in calculation:
  Solvent content: 0.70
  Unit cell volume: 476839
  Molecular weight: 8000.00
  Number of symmetry operators: 4
</pre>
<p>HySS will go on searching for 12 sites.</p>
<P><H5><U><B>If things go wrong</B></U></H5><P>
<p>If the HySS consensus model does not lead to an interpretable electron
density map please try the <tt class="docutils literal"><span class="pre">--search</span> <span class="pre">full</span></tt> option:</p>
<pre class="literal-block">
phenix.hyss your_file.sca 100 se --search full
</pre>
<p>This disables the automatic termination detection and the run will in
general take considerably longer. If the full search leads to a better
consensus model please let us know because we will want to improve the
automatic termination detection.</p>
<p>Another possibility is to override the automatic determination of the
high-resolution limit with the <tt class="docutils literal"><span class="pre">--resolution</span></tt> option. In some cases
the resolution limit is very critical. Truncating the high-resolution
limit of the data can sometimes lead to a successful search, as
more reflections with a weak anomalous signal are excluded.</p>
<p>If there is no consensus model at the end of a HySS run please try
alternative programs. For example, run SHELXD with the <tt class="docutils literal"><span class="pre">.ins</span></tt> and
<tt class="docutils literal"><span class="pre">.hkl</span></tt> files that are automatically generated by HySS:</p>
<pre class="literal-block">
Writing anomalous differences as SHELX HKLF file: mbp_anom_diffs.hkl

Writing SHELXD ins file: mbp_anom_diffs.ins
</pre>
<p>If HySS does not produce a consensus model even though it is possible
to solve the substructure with other programs we would like to
investigate. Please send email to <a class="reference" href="mailto:bugs&#64;phenix-online.org">bugs&#64;phenix-online.org</a>.</p>
<P><H5><U><B>Auxiliary programs</B></U></H5><P>
<P><H5><U><B>phenix.emma</B></U></H5><P>
<p><em>EMMA</em> stands for <em>Euclidean Model Matching</em> which allows two sets of
coordinates to be superimposed as best as possible given symmetry and
origin choices. See the <a class="reference" href="emma.htm">phenix.emma</a> documentation for
more details.</p>
<P><H5><U><B>phenix.xtriage</B></U></H5><P>
<p>The <tt class="docutils literal"><span class="pre">phenix.xtriage</span></tt> program performs an extensive suite of tests to
assess the quality of a data set. It is a good idea to always run this
program before substructure location or any other steps of structure
solution. See the <a class="reference" href="xtriage.htm">phenix.xtriage</a> documentation for
more details.</p>
<P><H5><U><B>phenix.reflection_statistics</B></U></H5><P>
<p>Comparision between multiple datasets is available using the
<tt class="docutils literal"><span class="pre">phenix.reflection_statistics</span></tt> command. See the
<a class="reference" href="reflection_statistics.htm">phenix.reflection_statistics</a>
documentation for more details.</p>
<!--REMARK PHENIX BODY END-->
