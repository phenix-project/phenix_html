
<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Fitting loops to fill in gaps in models
    with fit_loops</U></H4>


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here.
Anything enclosed in header html H4 H5 etc will go in the table of contents>


<P><H5><U>Author(s)</U></H5><P>

<UL>
<LI>fit_loops: Tom Terwilliger
</LI></UL>

<P><H5><U>Purpose</U></H5><P>

fit_loops is a tool for building a loop into density 
to connect existing chain ends.  You supply a model with a gap and a
sequence file and 
coefficients for an electron density map, and you specify the first and
last residues to be built. Then fit_loops will attempt to build the
loop that you specify. One loop can be done at a time with fit_loops 
(but if you have multiple identical chains, you can fit them
all at once). 
<P>You can use either of two methods to fit the loops. By default fit_loops
uses resolve chain extension to try to trace residues from the ends of 
segments in your input PDB file. If it can connect the segments, it writes out
the connecting loops.  Alternatively you can use a loop library supplied
with PHENIX to connect ends of segments from your input PDB file.

<p>If you 
want a more complete model-building process, then you will want to 
use <a href="autobuild.htm">phenix.autobuild </a>.
<p>fit_loops can be run from the command line or from the PHENIX GUI.

<P><H5><U>Usage</U></H5><P>

<P><H5>How fit_loops works:</H5><P>

fit_loops calculates a map based on the supplied map coefficients,
then tries to extend the ends of the supplied model into the gap region,
following the electron density in the map.

<P><H5><I>Output files from fit_loops</I></H5><P>

<b>model_with_loops.pdb</b>: The output from fit_loops is a new PDB file
containing your input model with the newly-built loop inserted into
it (if a loop could be found).

<P><H5><U>Examples</U></H5><P>

<P><H5>Standard run of fit_loops:</H5><P>

A typical command-line input would be:
<PRE style="face=courier">
phenix.fit_loops pdb_in=nsf_gap.pdb mtz_in=map_coeffs.mtz \
 seq_file=nsf.seq start=37 end=43 chain_id=None
</PRE>
This will fit a loop starting with residue 37 and ending with residue
43 in nsf_gap.pdb.  phenix.fit_loops will expect that your existing
nsf_gap.pdb model has a chain ending at residue 36 and another starting
at residue 44.  As chain_id=None in this example, if there are
multiple chains A,B,C in nsf_gap.pdb then all 3 will be filled in.

<P><H5>Specifying column names</H5><P>
<p>If you want (or need) to specify the column names from your mtz file, you
will need to tell fit_loops what FP and PHIB (and optionally FOM)
are, in this format:

<PRE style="face=courier">
phenix.fit_loops pdb_in=nsf_gap.pdb mtz_in=map_coeffs.mtz \
 seq_file=nsf.seq start=37 end=43 chain_id=None \
labin="FP=2FOFCWT PHIB=PH2FOFCWT"
</PRE>

<P><H5>Fitting a loop with poor density</H5><P>
<p>If you want to try and fit a loop with poor density, you 
might want to lower the threshold for the correlation of density
in the loop (default minimum correlation is 0.2):
<PRE style="face=courier">
phenix.fit_loops pdb_in=nsf_gap.pdb mtz_in=map_coeffs.mtz \
 seq_file=nsf.seq start=37 end=43 chain_id=None \
loop_cc_min=0.1</PRE>

<P><H5>Using a loop library</H5><P>
<p>To use the loop library in PHENIX, use the keyword loop_lib:
<PRE style="face=courier">
phenix.fit_loops pdb_in=nsf_gap.pdb mtz_in=map_coeffs.mtz \
 seq_file=nsf.seq start=37 end=39 chain_id=None loop_lib=True
</PRE>
This will fit a loop starting with residue 37 and ending with residue 39.
The maximum current length in the loop library is 3 residues.

<P><H5>Using a loop library to connect all segments</H5><P>
<p>To use the loop library in PHENIX and try to connect any pair of segments 
that have an  geometrical relationship, use the keyword connect_all:
<PRE style="face=courier">
phenix.fit_loops pdb_in=nsf_gap.pdb mtz_in=map_coeffs.mtz \
 seq_file=nsf.seq connect_all=True
</PRE>
This will go through all pairs of segments, trying to connect them with a loop
from the PHENIX loop library. Note that this is a last-resort approach, normally
instead use the default and let fit_loops connect segments that are close in
sequence.

<P><H5>Specifying a gap to fill in</H5><P>
<p>To specify a particular gap for loop fittin, you can say
<PRE style="face=courier">
phenix.fit_loops pdb_in=nsf_gap.pdb mtz_in=map_coeffs.mtz \
 seq_file=nsf.seq start=37 end=39 chain_id=A
</PRE>
Note the residue number for start and end are the first and last in the gap, not the residues flanking the gap that are already present.

<P><H5><U>Possible Problems</U></H5><P>

<P><H5>Specific limitations and problems:</H5><P>

<P><H5><U>Literature</U></H5><P>

<P><H5><U>Additional information</U></H5><P>


<!--REMARK PHENIX BODY END-->
