
<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Model editing with Sculptor</U></H4> 


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here. 
Anything enclosed in header html H4 H5 etc will go in the table of contents>


<P><H5><U><B>Author(s)</B></U></H5></P>
<UL>
<LI>sculptor: Gabor Bunkoczi</LI>
<LI>PHENIX GUI: Nathaniel Echols</LI>
</UL>

<P><H5><U>Purpose</U></H5></P>

<P>
Sculptor can be used to improve a molecular replacement model using additional
information available from an alignment and/or structure.
</P>

<P><H5><U>Conventions</U></H5></P>

<P>
The following terms are used with the special meaning:
<UL>
<LI><B>target:</B> the structure to be solved</LI>
<LI><B>model:</B> the structure used as a model for the target</LI>
</UL>
</P>

<P><H5><U>Usage</U></H5></P>
<P>
Sculptor can be run from the PHENIX GUI and the command line, the only
difference being the way commands are taken from the user.
</P>

<P><H5>Input files</H5></P>
<UL>
<LI><B>Structures</B> <I>(compulsory)</I>. The structure to be modified.
Specific parts can be selected using CNS-style atom selection syntax. Chains
are divided into <I>protein</I> and <I>other</I> chain categories, and
processed according to instructions given for the appropriate chain type.
Accepted formats: PDB. Recognized extensions: <TT>.pdb</TT>, <TT>.ent</TT>.</LI>
<LI><B>Alignments</B> Provides reliability information that can be used for
calculating modifications for <I>protein</I> chains. The chains are
automatically associated with the corresponding alignment based on a sequence
comparison. No alignment information is used when processing <I>other</I>
chains. If no calculation needs alignment information, alignment input is
optional, otherwise compulsory. Multiple alignment files can be provided to
cover all distinct <I>protein</I> chains in the structure. By convention, the
first sequence of the alignment is the <B>target</B> sequence, but this can be
overridden by using the <TT><B>target index</B></TT> parameter of the
<TT><B>alignment</B></TT> scope. Accepted extensions (with the corresponding
format) are <TT>.aln</TT> (CLUSTAL format), <TT>.pir</TT> (PIR-format) and
<TT>.ali</TT> (relaxed PIR-like format).</LI>
<LI><B>Sequence files</B> In case no alignment is available, sculptor can
prepare an alignment if the <B>target</B> sequence and the corresponding
<B>model</B> chain selection is provided. Multiple sequence files can be
provided with different target sequences for distinct protein chains. Accepted
extensions are <TT>.fasta</TT>, <TT>.faa</TT> or <TT>.fa</TT> for FASTA format,
<TT>.pir</TT> for PIR-format and <TT>.seq</TT> or <TT>.dat</TT> for a relaxed
PIR/FASTA-like format.</LI>
</UL>

<P><H5>Command line</H5></P>
<PRE><TT><B>phenix.sculptor</B> \
    [ command-line switches ] \
    [ PHIL-format parameter files ] \
    [ PHIL command-line assignments ] \
    [ PDB-files ] \
    [ alignment files ]</TT></PRE>

<P><H6>Command-line switches:</H6></P>
<PRE><TT>
  <B>-h, --help</B>            show this help message and exit
  <B>--show-defaults</B>       print PHIL and exit
  <B>-i, --stdin</B>           read PHIL from stdin as well
  <B>-v, --verbosity</B>       set verbosity level (DEBUG,INFO,WARNING,VERBOSE)
  <B>--mode</B>                set mode (flexible,predefined)
</TT></PRE>

<P><H6>PHIL arguments:</H6></P>
<P>
Everything not starting with a dash ('-') is interpreted as a PHIL argument.
This can be a PHIL-format file containing parameters, command-line assignment
or a file whose type is automatically recognized (based on file extension).
Note that sequence files are not accepted on the command line, since associated
chains could not easily be guessed and require a fully specified parameter
scope.
</P>

<P><H5>GUI</H5></P>
<P>
The graphical user interface makes all settings accessible either as part of
the main window (for frequently used options) or through a series of dialog
boxes under <B>Settings for:</B>: <I>Main-chain removal</I>, <I>Main-chain
polishing</I>, <I>Sidechain pruning</I>, <I>B-factors</I>, <I>Renumbering</I>
and <I>Renaming</I>. The input PDB file is specified in the <B>PDB file:</B>
input line, while alignments and target sequences can be added through the
<I>Sequence alignment files...</I> and the <I>Sequence files...</I> dialog
boxes, respectively.
</P>

<P><H5>Output files</H5></P>
<P>
In <TT><B>flexible</B></TT> mode, the fully processed structure is output. The
file is named according to the following convention: <TT>root_pdb.pdb</TT>,
where <TT><B>root</B></TT> is a user-defined parameter (accessible from the
<TT><B>output</B></TT> scope), and <TT><B>pdb</B></TT> is the basename of the
input PDB file. In <TT><B>predefined</B></TT> mode, there is an output file
produced for each requested protocol, and named according to
<TT>root_pdb_N.pdb</TT>, where N is the number of the corresponding protocol.
</P>

<P><H5><U>Description</U></H5></P>
<P>
The workflow consists of several stages that can be independently configured.
These are listed in order of execution.For a summary of all keywords with the
corresponding defaults, see the <B>Additional information</B> section.
</P>

<P><H5>Preprocessing</H5></P>
<UL>
<LI><TT><B>selection</B></TT>: selects a subset of the input PDB file, using
CNS-style atom selection syntax. Default: <TT>all</TT>.</LI>
<LI><TT><B>remove_alternate_conformations</B></TT>: selects the first alternate
conformation for disordered entities, and discards the rest. Also involes
<TT>sanitize_occupancies</TT>.</LI>
<LI><TT><B>sanitize_occupancies</B></TT>: resets all occupancies to 1.0.</LI>
</UL>
<P>
In addition, chains will be analysed, and solvent atoms will be separated from
protein chains if they are not separated by <TT>TER</TT> cards.
</P>

<P><H5>Protein chains</H5></P>

<P><H6>Deletion</H6></P>
<P>
Discards residues from a model chain that are unlikely to improve signal in
molecular replacement. This information is calculated from the alignment.
</P>
<P>
There are multiple algorithms available:
</P>
<UL>
<LI><TT><B>gap</B></TT>: Deletes residues that are not present in the target
(model residue is aligned with a gap). For this algorithm, the supplied
alignment is used as a pairwise alignment.</LI>
<LI><TT><B>threshold_based_similarity</B></TT>: Deletes residues for which the
sequence similarity is below a certain threshold. All sequences in a multiple
alignment contribute to the score. Details of the sequence similarity
calculation are given in the section <B>Sequence similarity</B>.</LI>
<LI><TT><B>completeness_based_similarity</B></TT>: Deletes the same number of
residues (modified by a fractional offset) as the <TT><B>gap</B></TT> algorithm
would but residues that get removed are the ones with the lowest sequence
similarity. This way the default values are valid over a much larger sequence
similarity range than those in <TT><B>threshold_based_similarity</B></TT>. All
sequences in a multiple alignment contribute to the score. Details of the
sequence similarity calculation are given in the section
<B>Sequence similarity</B>.</LI>
</UL>
<P>
These algorithms can also be used together in any combination. In this case, a
residue will be deleted if assigned for deletion by any active algorithms.
</P>

<P><H6>Polishing</H6></P>
<P>
Makes small adjustments to the mainchain of a chain (taking results from
deletion into account) to make it obey basic macromolecular features.
</P>
<UL>
<LI><TT><B>remove_short</B></TT>. Deletes additional residue segments from the
molecule so that no continuous segment is shorter than a preset limit
(determined  by the <TT><B>minimum_length</B></TT> parameter of the
<TT><B>remove_short</B></TT> scope). Segment boundaries are determined from
spatial connectivity of residues. This algorithm is primarily intended to
remove "floating" residues that are the result of extensive loop
truncation.</LI>
<LI><TT><B>keep_regular</B></TT>. Reinstate deleted residues if they are in
regular secondary structure and the segment marked for deletion is shorter than
the <TT><B>maximum_length</B></TT> parameter of the <TT><B>keep_regular</B></TT>
scope.</LI>
</UL>
<P>
These algorithms can also be used together in combination. In this case, the
chain will be processed sequentially by both algorithms.
</P>

<P><H6>Pruning</H6></P>
<P>
This phase determines the level distance from the C<SUB>alpha</SUB> atom up to
which a residue sidechain in the model is potentially similar to its
counterpart in the target.
<P>
<UL>
<LI><TT><B>schwarzenbacher</B></TT>. Implements the algorithm published by
Schwarzenbacher <I>et al.</I> (2004), who propose that for optimal molecular
replacement results a residue sidechain should be truncated if aligned with a
non-identical residue, and not truncated otherwise. The level of truncation is
controlled by the <TT>pruning_level</TT> parameter, and defaults to 3 (which
corresponds to  C<SUB>gamma</SUB>) and can be controlled by the
<TT><B>pruning_level</B></TT> parameter of the <TT><B>schwarzenbacher</B></TT>
scope.</LI>
<LI><TT><B>Similarity</B></TT>. Uses sequence similarity values for deciding
the level of truncation. Residues above <TT><B>full_truncation_limit</B></TT>
are not truncated at all, those below the <TT><B>full_truncation_limit</B></TT>
are truncated to C<SUB>beta</SUB>, and those in between are truncated according 
to the <TT><B>pruning_level</B></TT> parameter (all available from the
<TT><B>similarity</B></TT> scopei). Results tend to be similar to those given
by the Schwarzenbacher algorithm; however, it is possible to get high similarity
values (and full sidechain preservation) for certain substitutions (i.e. TYR to
PHE), and low-sequence similarity zones can end up being truncated to
C<SUB>beta</SUB>. Details of the sequence similarity calculation are given in
the section <B>Sequence similarity</B>.</LI>
</UL>
<P>
These algorithms can also be used together in any combination, in which case
the sidechain will be truncated to the shortest value suggested.
</P>
</P>

<P><H6>B-factor prediction</H6></P>
<P>
B-factor prediction tries to increase B-factors for atoms that are likely to be
more flexible or more in error. The calculation takes simple physical
properties into account, and these are linearly transformed to B-factors
(controlled by the <TT><B>factor</B></TT> parameter of the corresponding scope).
If this value is lower than the <TT>minimum</TT> (from the
<TT><B>bfactor</B></TT>scope) parameter, a constant is added to all B-factors
so that the lowest of those equals to <TT><B>minimum</B></TT> (this is primarily
intended to avoid negative B-factors).
</P>
<UL>
<LI><TT><B>original</B></TT>. This uses the original B-factor of atoms. This is
primarily intended as a contributor to a combination, but can also be used to
manipulate current B-factors, e.g. set them to a constant value.</LI>
<LI><TT><B>asa</B></TT>. This calculates accessible surface area for an
isolated chain and transforms the raw values to B-factors. A high ASA-value
indicates a potential for flexibility. The calculation can be configured by the
<TT><B>precision</B></TT> and <TT><B>probe_radius</B></TT> parameters of the
<TT><B>asa</B></TT> scope.</LI>
<LI><TT><B>similarity</B></TT>. Low sequence similarity regions tend to be
more dissimilar. Details of the sequence similarity calculation are given
in the section <B>Sequence similarity</B>.</LI>
</UL>
<P>
Algorithms can be used in combination, in which case the sum of the predicted
B-factors is used. This mode can also be used to map sequence similarity or
accessible surface area to residues/atoms for display purposes.
</P>

<P><H6>Renumber</H6></P>
<P>
Renumbers residues according to the <TT><B>target</B></TT> or
<TT><B>model</B></TT> sequence. It is also possible to turn renumbering off
(option <TT><B>original</B></TT>).
<P>

<P><H6>Rename</H6></P>
<P>
Renames residues according their counterpart in the target sequence. It also
"morphs" the sidechain, i.e. renames atoms and deletes atoms that are not
present. It can also generate missing atoms, if their positions are determined
unambigously by present atoms (available via the <TT><B>completion</B></TT> 
parameter of the <TT><B>macromolecule</B></TT> scope).
<P>
<UL>
<LI><TT><B>cbeta</B></TT>. Adds C<SUB>beta</SUB> atom if the residue is not
glycine, and C, N and C<SUB>alpha</SUB> atoms are all present.</LI>
</UL>

<P><H5>Non-macromolecular chains</H5></P>
<P>
Residues in these chains are normally deleted, unless an exception is made by
specifying the residue codes that are to be retained. This is primarily
intended to keep a known ligands of protein classes (e.g. HEM).
</P>

<P><H5><U>Sequence similarity calculation</U></H5></P>
<P>
Sequence similarity is calculated from the full alignment supplied (taking all
present sequences into account), using a scoring matrix (currently
<TT><B>blosum50</B></TT>, <TT><B>blosum62</B></TT>, <TT><B>dayhoff</B></TT> and
<TT><B>identity</B></TT> are available). Raw scores are then averaged over a
<TT><B>window</B></TT> of residues (defaults to 5 residues in both directions)
that is weighted using either <TT><B>uniform</B></TT> or
<TT><B>triangular</B></TT> weights. The resulting scores are "normalized" so
that 1.0 would indicate a perfect alignment, 0.0 would be a random match, and
-1.0 a (locally) fully gapped alignment (on average). Note, it is possible to
obtain values outside this range. This helps to ensure that defaults are
sensible irrespective of the choice for the scoring matrix.
</P>
<P>
Sequence similarity calculation is configured individually for the steps that
are using it.
</P>

<P><H5><U>Specific limitations and possible problems</U></H5></P>
<P><H5>Processing features</H5></P>
<UL>
<LI>Very short residue segments (shorter than 3 consecutive residues) cannot be
reliably aligned to the sequence, and these will be discarded from the
model.</LI>
<LI>The <TT><B>similarity</B></TT> algorithm from the <TT><B>deletion</B></TT>
scope may result in residues that are aligned with a gap being included in the
model. Although this possibly indicates an error in the alignment and is
potentially beneficial for molecular replacement, this causes a problem at the
<TT><B>rename</B></TT> stage, as there is no 3-letter residue name for a "-";
these residues are tentatively named <TT><B>GAP</B></TT>.</LI>
<LI>Residue numbers for GAP residues are built up using the residue number of
the previous non-GAP residue and an insertion code (A-Z, depending on the number
of GAP residues after the previous non-GAP residue).</LI>
</UL>

<P><H5>Error messages</H5></P>
<UL>
<LI><TT><B>No pdb files specified</B></TT>: there are no PDB files to
process.</LI>
<LI><TT><B>No atoms left after atom selection</B></TT>: the atom selection
provided results in an empty structure.</LI>
<LI><TT><B>No alignment</B></TT>: no alignments have been provided and the
calculation requires alignment information.</LI>
<LI><TT><B>No sufficiently similar alignment sequences have been
found</B></TT>: the longest exact overlap between the chain sequence and any
alignment sequences is lower than the <TT><B>min_hssp_length</B></TT>
parameter (typically 6 residues), therefore no alignment corresponds to this
chain.</LI>
<LI><TT><B>Unable to align: matching fraction < min_matching_fraction</B></TT>:
the best matching alignment does not match the chain sufficiently (specified by
the <TT><B>min_matching_fraction</B></TT> parameter, typically 40%), and it is
likely that the alignment is incorrect.</LI>
</UL>

<P><H5>Warning messages</H5></P>
<UL>
<LI><TT><B>There are N sequences with longest overlap</B></TT>: N sequences
give identical matching statistics with the current chain. Lacking other
criteria, the first is selected. Ordering is affected by the sequence of
alignment files passed to the program and the order of sequences in the
alignment file.</LI>
<LI><TT><B>Unaligned residues</B></TT>: certain residues could not be aligned
reliably with the sequence because they appear in very short segments and
sequence matching can be arbitrary. The minimum length of an accepted segments
is controlled by the <TT><B>min_hssp_length</B></TT> parameter.</LI>
<LI><TT><B>Sequence mismatches</B></TT>: there are mismatches between the
alignment and the chain sequence. These are typically caused by unknown
residues codes assigned to uncommon or modified residues. If the sequence
identity falls below a preset threshold (controlled by the
<TT><B>min_matching_fraction</B></TT> parameter), and error is raised.</LI>
<LI><TT><B>File contains multiple sequences, only the first will be
used</B></TT>: the sequence file used to provide the target sequence for given
chains contains multiple sequences. The first sequence will be accepted as
correct.</LI>
</UL>

<P><H5><U>Literature</U></H5></P>
<UL>
<LI>
    <B>The importance of alignment accuracy for molecular replacement.</B>
    R. Schwarzenbacher, A. Godzik, S. K. Grzechnik and L. Jaroszewski
    <I>Acta Cryst.</I> <B>D60</B>, 1229-1236 (2004)
</LI>
</UL>

<P><H5><U>Citation</U></H5></P>
<P>
    <B>Improvement of molecular-replacement models with Sculptor.</B>
    G. Bunkoczi and R. J. Read
    <I>Acta Cryst.</I> <B>D67</B>, 303-312 (2011)
</P>

<P><H5><U>Additional information</U></H5></P>

<!--REMARK PHENIX BODY END-->
