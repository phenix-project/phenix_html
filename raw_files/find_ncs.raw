<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Finding and analyzing NCS from heavy-atom sites or a model with find_ncs</U></H4>


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here.
Anything enclosed in header html H4 H5 etc will go in the table of contents>
<P><H5><U><B>Authors:</B></U></H5><P>
<ul>
<li>find_ncs: Tom Terwilliger</li>
<li>simple_ncs_from_pdb : Tom Terwilliger</li>
<li>Phil command interpreter: Ralf W. Grosse-Kunstleve</li>
<li>find_domain: Peter Zwart</li>
</ul>
<P><H5><U><B>Purpose</B></U></H5><P>
<p>The find_ncs method identifies NCS in (a) the chains in a PDB file or (b) a set of heavy-atom sites, or (c) from the density in a map and writes out the NCS operators in forms suitable for phenix.refine, resolve, and the AutoSol and AutoBuild Wizards.</p>
<P><H5><U><B>How find_ncs works</B></U></H5><P>
<p>The basic steps that the find_ncs carries out are:</p>
<ul>
<li>Decide whether to use simple_ncs_from_pdb (used if the input file contains chains from a PDB file) or RESOLVE NCS identification (used if the input file contains heavy-atom sites) or find_ncs_from_density (used if a map is supplied and sites are not found from either of the above)</li>
<li>call either simple_ncs_from_pdb or RESOLVE or find_ncs_from_density to identify NCS</li>
<li>Evaluate the NCS by calculating the correlation of NCS-related electron density based on the input map coefficients mtz file.</li>
<li>Report the NCS operators and correlations</li>
</ul>
<P><H5><U><B>Output files from find_ncs</B></U></H5><P>
<p>The output files that are produced are:</p>
<ul>
<li>NCS operators written in format for phenix.refine: find_ncs.ncs</li>
<li>NCS operators written in format for the PHENIX Wizards: find_ncs.ncs_spec</li>
</ul>
<P><H5><U><B>What find_ncs needs</B></U></H5><P>
<ul>
<li>find_ncs needs a file with map coefficients and optionally a second file containing NCS information.</li>
</ul>
<p>The file with NCS information can be...</p>
<ul>
<li>a PDB file with a model (find_ncs will call simple_ncs_from_pdb to extract NCS operators from the chains in your model)</li>
<li>a PDB file with heavy-atom sites (find_ncs will call RESOLVE to find NCS operators from your heavy-atom sites)</li>
<li>an NCS definitions file written by a PHENIX wizard (e.g., AutoSol_1.ncs_spec, produced by AutoSol)</li>
<li>a RESOLVE log file containing formatted NCS operators</li>
</ul>
<P><H5><U><B>Map coefficients file</B></U></H5><P>
<p>The file with map coefficients can be any MTZ file with coefficients for a map. If find_ncs does not choose the correct columns automatically, then you can specify them with a command like:</p>
<p>labin=&quot;labin FP=FP PHIB=PHIB FOM=FOM &quot;</p>
<p>If you have no map coefficients yet (you just have some sites and want to get operators, for example), you can tell find_ncs to ignore the map with:</p>
<p>ncs_parameters.force_ncs=True</p>
<p>You still need to supply a map coefficients file (the map itself will be ignored though).</p>
<P><H5><U><B>Examples</B></U></H5><P>
<P><H5><U><B>Standard run of find_ncs</B></U></H5><P>
<p>If you have just a map coefficients file you can say:</p>
<p>phenix.find_ncs mlt.mtz</p>
<p>and find_ncs will look for NCS-related density in mlt.mtz (see find_ncs_from_density for more details on how this works)</p>
<p>If you have a model and a map file, from the command-line you can type:</p>
<p>phenix.find_ncs anb.pdb mlt.mtz</p>
<p>This will produce the following output:</p>
<pre class="literal-block">
Getting column labels from mlt.mtz for input map file
FILE TYPE:  ccp4_mtz
All labels:  ['FP', 'SIGFP', 'PHIC', 'FOM']
Labin line will be:  labin FP=FP PHIB=PHIC FOM=FOM
To change it modify this: params.ncs.labin=&quot;labin FP=FP PHIB=PHIC FOM=FOM &quot;
This is the map that will be used to evaluate NCS

Reading NCS information from:  anb.pdb
Copying  mlt.mtz  to  temp_dir/mlt.mtz
This PDB file contains 2  chains and  636  total residues
and  636  C-alpha or P atoms  and  4740  total atoms
NCS will be found using the chains in this PDB file
Chains in this PDB file:  ['M', 'Z']
Two chains were found in the file anb.pdb, chain M and chain Z

GROUPS BASED ON QUICK COMPARISON: []
Looking for invariant domains for ...: ['M', 'Z'] [[[2, 138], [193, 373]], [[2, 138], [193, 373]]]
Residues 2-138, 193-373, matched between the two chains

Copying  mlt.mtz  to  temp_dir/mlt.mtz
Copying  temp_dir/NCS_correlation.log  to  NCS_correlation.log
Log file for NCS correlation is in  NCS_correlation.log
List of refined NCS correlations:  [1.0, 0.80000000000000004]
There were two separate groups of residues that had different NCS relationships. Residues 193-373 of each chain were in one group, and residues 2-138 in each chain were in the other group.

The electron density map had a correlation between the two NCS-related chains of 1.0 for the first group, and 0.8 for the second

The NCS operators for each are listed.

GROUP 1
Summary of NCS group with 2 operators:
ID of chain/residue where these apply: [['M', 'Z'], [[[193, 373]], [[193, 373]]]]
RMSD (A) from chain M:  0.0  0.0
Number of residues matching chain M:[181, 181]
Source of NCS info: anb.pdb
Correlation of NCS: 1.0

OPERATOR 1
CENTER:   69.1058   -9.5443   59.4674

ROTA 1:    1.0000    0.0000    0.0000
ROTA 2:    0.0000    1.0000    0.0000
ROTA 3:    0.0000    0.0000    1.0000
TRANS:     0.0000    0.0000    0.0000

OPERATOR 2
CENTER:   37.5004  -37.0709  -62.5441

ROTA 1:    0.7751   -0.6211   -0.1162
ROTA 2:   -0.3607   -0.5859    0.7256
ROTA 3:   -0.5188   -0.5205   -0.6782
TRANS:     9.7485   27.6460   17.2076

GROUP 2
Summary of NCS group with 2 operators:
ID of chain/residue where these apply: [['M', 'Z'], [[[2, 138]], [[2, 138]]]]
RMSD (A) from chain M:  0.0  0.0
Number of residues matching chain M:[137, 137]
Source of NCS info: anb.pdb
Correlation of NCS: 0.8

OPERATOR 1
CENTER:   66.6943  -13.3128   21.6769

ROTA 1:    1.0000    0.0000    0.0000
ROTA 2:    0.0000    1.0000    0.0000
ROTA 3:    0.0000    0.0000    1.0000
TRANS:     0.0000    0.0000    0.0000

OPERATOR 2
CENTER:   39.0126  -53.7392  -13.4457

ROTA 1:    0.3702   -0.9275   -0.0516
ROTA 2:   -0.8933   -0.3402   -0.2938
ROTA 3:    0.2549    0.1548   -0.9545
TRANS:     1.7147   -0.6936    7.2172
</pre>
<P><H5><U><B>References</B></U></H5><P>
<!--REMARK PHENIX BODY END-->
