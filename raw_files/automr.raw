
<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Automated molecular replacement with AutoMR </U></H4> 


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here. 
Anything enclosed in header html H4 H5 etc will go in the table of contents>


      <P><H5><U><B>Author(s)</B></U></H5><P>
<UL><LI>Phaser: Randy Read, Airlie McCoy and Laurant Storoni
<LI>AutoMR Wizard: Tom Terwilliger, Laurent Storoni, Randy Read, and Airlie McCoy
<LI>PHENIX GUI and PDS Server: Nigel W. Moriarty
<LI>phenix.xtriage: Peter Zwart
</UL>

      <P><H5><U>Purpose</U></H5><P>

<P><H5>Purpose of the AutoMR Wizard</H5><P>

<P>The AutoMR Wizard provides a convenient interface to Phaser molecular
replacement and feeds the results of molecular replacement directly
into the AutoBuild Wizard for automated model rebuilding.

<P> The AutoMR Wizard begins with datafiles with
structure factor amplitudes and uncertainties, a search model or models,
and identifies  placements of the search models that are compatible with
the data.

      <P><H5><U>Usage</U></H5><P>
<P>The AutoMR Wizard can be run from the PHENIX GUI, from the command-line, 
and from keyworded script files.  All three versions are identical except
in the way that they take commands from the user. 
See 
<a href="running-wizards.htm">
Running a Wizard from a GUI, the command-line, or a script</a> 
for details of how to run a Wizard.
The command-line version will be described here.
<P>NOTE: You may find it easiest to run the GUI version of AutoMR when you
are learning how to use it, and then to move to the command-line or
script versions later, as the GUI version will take you through all the
necessary steps of organizing your data.

<P><H5>Summary of inputs and outputs for AutoMR</H5><P>

<P><B>Input data file</B>. 
This file can be in most any format, and must contain either
amplitudes or intensities and sigmas. You can specify what resolution to use
for molecular replacement and separately what resolution to use for model
rebuilding. If you specify "0.0" for resolution (recommended) then defaults
will be used for molecular replacement (i.e. use data to 2.5A if available to
solve structure, then carry out rigid body refinement of final solution with
all data) and all the data will be used for model rebuilding. 

<P><B>Composition of the asymmetric unit</B>. 
PHASER needs to know what the mass in the
asymmetric unit is. You can define this either by specifying one or more
protein or nucleic acid sequence files, or by specifying protein or nucleic
acid molecular masses, and telling the Wizard how many copies of each are
present. 

<P><B>Space groups to search</B>. 
You can request that all space groups with the same
point group as the one you start out with be searched, and the best one be
chosen. If you select this option then the best space group will be used for
model rebuilding in AutoBuild. 

<P><B>Ensembles to search for</B>. 
AutoMR builds up a model by finding a set of good
positions and orientations of one "ensemble", and then using each of those
placements as starting points for finding the next "ensemble", until all the
contents of the asymmetric unit are found and a consistent solution is
obtained. You can specify any number of different ensembles to search for, and
you can search for any number of copies of each ensemble. The order of
searching for ensembles does make a difference. You want to search for the
biggest and best-ordered ensemble first. You specify the order when you list
the ensembles to search for on the last main window of the AutoMR wizard. 

<P>
Each ensemble can be specified by a single PDB file or a set of PDB files. The
contents of one set of PDB files for an ensemble must all be oriented in the
same way, as they will be put together and used as a group always in the
molecular replacement process. 

<P>You will need to specify how similar you think each input PDB file that is
part of an ensemble is to the structure that is in your crystal. You can
specify either sequence identity, or expected rmsd. 


<P><B>Output of AutoMR</B>

<P><H5><I>Output files from AutoMR</I></H5><P>
<P>When you run AutoMR the output files will be in a subdirectory with
your run number:
<PRE style="face=courier">AutoMR_run_1_/   # subdirectory with results
</PRE>

<P><UL><LI>A summary file listing the results of the run and
the other files produced:
<PRE style="face=courier">AutoMR_summary.dat  # overall summary
</PRE>

<P><LI>A warnings file listing any warnings about the run
<PRE style="face=courier">AutoMR_warnings.dat  # any warnings
</PRE>

<P><LI>A file that lists all parameters and knowledge accumulated
by the Wizard during the run (some parts are binary and are not printed)
<PRE style="face=courier">AutoMR_Facts.dat   # all Facts about the run
</PRE>

<P><LI>Molecular replacement model, structure factors, and map coefficients:
<PRE style="face=courier">MR.1.pdb
MR.1.mtz
MR.MAP_COEFFS.1.mtz
</PRE>
The AutoMR wizard writes out MR.1.pdb and MR.1.mtz and
MR.MAP_COEFFS.1.mtz well as output log files. The MR.1.pdb file will contain
all the components of your MR solution. If there are multiple PDB files in an
ensemble, the first model is placed in the new unit cell and written to
MR.1.pdb. If there are multiple copies of a model, the chains are lettered
sequentially A B C... The MR.1.mtz file contains the data from your input file
to the full resolution available. The MR.MAP_COEFFS.1.mtz file contains
sigmaA-weighted 2Fo-Fc map coefficients based on the rigid-body-refined model.
</UL>
<P><B>Model rebuilding</B>. 
After PHASER molecular replacement the AutoMR Wizard loads
the AutoBuild Wizard and sets the defaults based on the MR solution that has
just been found. You can use the default values, or you may choose to use
2Fo-Fc maps instead of density-modified maps for rebuilding, or you may choose
to start the model-rebuilding with the map coefficients from
MR.MAP_COEFFS.1.mtz.

<P>
<P><H5>How to run the AutoMR Wizard</H5><P>
<P>  Running the AutoMR Wizard is easy.  For example, 
from the command-line you can type:
<PRE style="face=courier">phenix.automr native.sca search.pdb RMS=0.8 mass=23000 copies=1
</PRE>
<P>The AutoMR Wizard will find the best location and orientation of
the search model search.pdb in the unit cell based on the data in native.sca, 
assuming that the RMSD between the correct model and search.pdb is about
0.8 A, that the molecular mass of the true model is 23000 and that there
is 1 copy of this model in the asymmetric unit. Once the AutoMR Wizard has
found a solution, it will automatically call the AutoBuild Wizard and
rebuild the model.

<P><H5>Components, copies, search models, and ensembles</H5><P>
<P><UL><LI>Your structure is composed of one or more <B>components</B> such as a 
20Kd subunit with sequence seq-of-20Kd-subunit.
<P><LI>There may be one or more <B>copies</B> of each <B>component</B>  
in your structure.
<P><LI>You can search for the location(s) of a <B>component</B> with a 
<B>search model</B> that consists of a single structure or 
an <B>ensemble</B> of structures.
</UL>

<P><H5>What the AutoMR wizard needs to run</H5><P>
<P>In a simple case where you have one search model and are looking for 
N copies of this model in your structure, you need:
<P><UL><LI>(1) a datafile name (native.sca or data=native.sca)
<P><LI>(2) a search model (search_model.pdb or coords=search_model.pdb)
<P><LI>(3) a how similar the search model is to your structure (
RMS=0.8 or identity=75)
<P><LI>(4) information about the contents of the asymmetric unit:
   (mass=23000 or seq_file=seq.dat)  and (copies=1)
</UL>

<P>It may be advantageous to search using an ensemble of similar 
structures, rather than a single structure.
If you have an ensemble of search models to search for, then specify it as
<PRE style="face=courier">coords='model_1.pdb model_2.pdb model_3.pdb'
</PRE>
<P>In this case you need to give the RMS or identity for each model:
identity='45 40 35'.  Each of the models in the ensemble must be in the
same orientation as the others, so that the ensemble of models can be placed
as a group in the unit cell.

<P>If you are searching for more than one ensemble, or if there is more
than one component in the a.u., then use the full syntax and specify them as
(NOTE copies becomes copies_to_find or component_copies):
<PRE style="face=courier">ensemble_1.coords=s1.pdb ensemble_1.RMS=0.8 ensemble_1.copies_to_find=1 \
   component_1.mass=23000 component_1.component_copies=1
</PRE>

<P><H5>Specifying which columns of data to use from input data files</H5><P>
<P>If one or more of your data files has column names that the Wizard
cannot identify automatically, you can specify them yourself. You
will need to provide one column "name" for each expected column of data,
with "None" for anything that is missing.

<P>For example, if your data file data.mtz has columns F SIGF 
then you might specify
<PRE style="face=courier">data=data.mtz
input_label_string="F SIGF"
</PRE>

<P>You can find out all the possible label strings in a data file that
you might use by typing:
<PRE style="face=courier">phenix.autosol display_labels=data.mtz  # display all labels for data.mtz
</PRE>

<P>You can specify many more parameters as well. See the list of
keywords, defaults and descriptions at the end of this page and
also general information about running Wizards at
<a href="running-wizards.htm">
Running a Wizard from a GUI, the command-line, or a script</a> 
for how to do this.  Some of the most common parameters are:
<PRE style="face=courier">data=w1.sca       # data file
model=coords.pdb  # starting model
seq_file=seq.dat  # sequence file
</PRE>

      <P><H5><U>Examples</U></H5><P>

<P><H5>Standard AutoMR run with coords.pdb native.sca </H5><P>
<P>Run AutoMR using coords.pdb as search model, native.sca as data, 
assume RMS between coords.pdb and true model is about 0.85 A, the
sequence of true model is seq.dat and there are 1 copies in the unit cell:
<PRE style="face=courier">phenix.automr coords.pdb native.sca RMS=0.85 seq.dat copies=1  \
    n_cycle_rebuild_max=2 n_cycle_build_max=2
</PRE>

<P><H5>Specifying data columns </H5><P>
<P>Run AutoMR as above, but specify the data columns explicitly:
<PRE style="face=courier">phenix.automr coords.pdb RMS=0.85 seq.dat copies=1  \
    data=data.mtz input_label_string="F SIGF"  \
    n_cycle_rebuild_max=2 n_cycle_build_max=2 
</PRE>
Note that the data columns are specified by a string that includes both
F and SIGF : "F SIGF".  The string must match some set of data labels
that can be extracted automatically from your data file.
You can  find the possible values of this string as described above 
with 
<PRE style="face=courier">phenix.automr display_labels=data.mtz
</PRE>

<P><H5>Specifying a refinement file for AutoBuild</H5><P>
<P>Run AutoMR as above, but specify a refinement file that is different from
the file used for the MR search:
<PRE style="face=courier">phenix.automr coords.pdb RMS=0.85 seq.dat copies=1  \
    data=data.mtz input_label_string="F SIGF"  \
    autobuild_input_refinement_file=refinement.mtz \
    autobuild_input_refinement_labels="FP SIGFP FreeR_flag"  \
    n_cycle_rebuild_max=2 n_cycle_build_max=2 
</PRE>
Note that the commands input_refinement_file and input_refinement_labels are
preceded by autobuild_ . These commands and others with this prefix are
passed on to AutoBuild.

<P><H5>Passing any commands to AutoBuild</H5><P>
<p>You can pass any AutoBuild commands on to AutoBuild, even if they
are not already defined for you in AutoMR. Use the
command <b>autobuild_input_list_add</b> to add a command, and then
apply that command by adding &quot;autobuild_&quot; to the beginning of
the command name. For example, to add the 
commands semet=True and refine=False: 
<PRE style="face=courier">phenix.automr coords.pdb RMS=0.85 seq.dat copies=1  \
    data=data.mtz input_label_string="F SIGF"  \
    autobuild_input_list_add='semet refine'  \
    autobuild_semet=True \
    autobuild_refine=False
</PRE>
Notes. This applies only to command-line operation of AutoMR.
Note that any keywords that are used in both AutoBuild and AutoMR will apply to 
both if you specify them in autobuild_input_list_add. For example if you 
set the resolution in AutoBuild with autobuild_input_list_add=resolution and
autobuild_resolution=2.6 then this resolution will apply to both AutoMR and
AutoBuild.

<P><H5>AutoMR searching for 2 components</H5><P>
<P>Run AutoMR on a structure with 2 components. Define the components of
the asymmetric unit with sequence files (beta.seq and blip.seq) and
number of copies of each component (1).  Define the search models
with PDB files and estimated RMS from true structures.
<PRE style="face=courier">phenix.automr data=beta_blip_P3221.mtz input_label_string="Fobs Sigma"  \
 resolution=0.0 resolution_build=3.0                               \
 component_1.component_type=protein component_1.seq_file=beta.seq  \
 component_1.component_copies=1                                    \
 component_2.component_type=protein component_2.seq_file=blip.seq  \
 component_2.component_copies=1                                    \
 ensemble_1.coords=beta.pdb ensemble_1.RMS=0.85 ensemble_1.copies_to_find=1 \
 ensemble_2.coords=blip.pdb ensemble_2.RMS=0.90 ensemble_2.copies_to_find=1 \
 n_cycle_rebuild_max=1
</PRE>

<P><H5>Specifying molecular masses of 2 components</H5><P>
<P>Run AutoMR as in the previous example, except specify the components
of the asymmetric unit with molecular masses (30000 and 20000), 
and define the search models
with PDB files and percent sequence identity with the true structures
(50% and 60%).
<PRE style="face=courier">phenix.automr data=beta_blip_P3221.mtz input_label_string="Fobs Sigma"  \
 resolution=0.0 resolution_build=3.0                               \
 component_1.component_type=protein component_1.mass=30000  \
 component_1.component_copies=1                                    \
 component_2.component_type=protein component_2.mass=20000 \
 component_2.component_copies=1                                    \
 ensemble_1.coords=beta.pdb ensemble_1.identity=50 ensemble_1.copies_to_find=1 \
 ensemble_2.coords=blip.pdb ensemble_2.identity=60 ensemble_2.copies_to_find=1 \
 n_cycle_rebuild_max=1
</PRE>


<P><H5>Combining MR and SAD phasing information (MRSAD)</H5><P>
You can combine MR information with SAD phases (see J. P. Schuermann and 
J. J. Tanner Acta Cryst. (2003). D59, 1731-1736 ) conveniently in PHENIX
by running the three wizards AutoMR, AutoSol, and AutoBuild one after the
other. Here is a set of three simple commands to do that:
<p>First run <b>AutoMR</b> to find the molecular replacement solution, but 
don't rebuild it yet:
<PRE style="face=courier">phenix.automr gene-5.pdb infl.sca copies=1 \
  RMS=1.5 mass=9800 rebuild_after_mr=False
</PRE>
<p>Now your MR solution is in <b>AutoMR_run_1_/MR.1.pdb</b> and 
phases are in <b>AutoMR_run_1_/MR.1.mtz</b>.  Use these phases as input
to AutoSol, along with some weak SAD data, still not building any new models:
<PRE style="face=courier"> phenix.autosol data=infl.sca \
 input_phase_file=AutoMR_run_1_/MR.1.mtz input_phase_labels="F PHIC FOM"   \
seq_file=sequence.dat build=False
</PRE>
<p> note that we have specified the data columns for F PHI and FOM in the
input_phase_file. For input_phase_file you must specify all three of these (if 
you leave out FOM it will set it to zero). </p>
<p>AutoSol will write an MTZ file with experimental phases to <b>phaser_xx.mtz</b> where xx depends on how many solutions are considered during the run.  The
next command for running AutoBuild  you will need to edit depending 
on the value of xx:
<PRE style="face=courier"> phenix.autobuild data=AutoSol_run_1_/phaser_2.mtz \
  model=AutoMR_run_1_/MR.1.pdb seq_file=sequence.dat rebuild_in_place=False
</PRE>
<p>AutoBuild will now take the phases from your AutoSol run and combine them
with model-based information from your AutoMR MR solution, and will carry
out iterative density modification, model-building and refinement to rebuild
your model. </p>
<p>Note that you may wish to set <b>rebuild_in_place=True</b>, 
depending on how good your MR model is.



      <P><H5><U>Possible Problems</U></H5><P>

<P><H5>Specific limitations and problems</H5><P>
<UL><LI>
<P>The AutoBuild Wizard can build PROTEIN, RNA, or DNA, but it can only
build one at a time.  If your MR model contains more than one type of chain,
then you will need to run AutoBuild separately from AutoMR and
specify one of them with input_lig_file and the type
of chain to build with chain_type:
<PRE style="face=courier"> 
input_lig_file=ProteinPartofMRmodel.pdb
chain_type=DNA
</PRE>

<P><LI> If you use an ensemble as a search model, the output structure will
contain just the first member of the ensemble, so you may wish to put
the member that is likely to be the most similar to the true structure as
the first one in your ensemble.

<P><LI> If you run AutoMR from the GUI and continue on to AutoBuild,
and then select &quot;Start run over (delete everything for this run)&quot;
it will delete your AutoBuild <b>and</b> your AutoMR run and start your
AutoMR run all over.

<P><LI>The AutoMR Wizard can take most settings of most space groups,
however it can only use the hexagonal setting of rhombohedral space groups 
(eg., #146 R3:H or #155 R32:H), and it cannot use space groups 114-119 (not
found in macromolecular crystallography) even in the standard setting 
due to difficulties with the use of asuset in the version of ccp4 libraries 
used in PHENIX for these settings and space groups.

<P><LI>The PHENIX Wizards will automatically read some parameters from
previous runs of the same and any other Wizard in the same directory. 
The parameters that are set this way are:

<PRE style="face=courier">chain_type
dmin
expt_type
find_ncs
input_seq_file
ligand_solutions
mad_ha_type
mask_type
ncs_copies
residues
resolution
semet
solvent_fraction
thorough_denmod
truncate_ha_sites_in_resolve
use_met_in_align
</PRE>

Setting defaults for these parameters in this way is usually helpful, but 
if you set them in one run it is important to keep in mind that the value 
you have set them to will become the default for future runs in that 
directory (unless you delete that run).  If there are multiple runs 
in which a parameter is set, then the one that was started last sets 
the default for that parameter.
</UL>

      <P><H5><U>Literature</U></H5><P>

<TABLE width=670 border=0>
  <TBODY>
  <TR>
    <TD>
      <TABLE cellSpacing=3 cellPadding=1 width="100%" align=center border=0>
        <TBODY>


        <TR id=mccoy2007>
          <TD align=left bgColor=#eeeee8><FONT face=Helvetica,Arial
            color=#000000 size=2><B>Phaser crystallographic software.</B> A. J.
            McCoy, R. W. Grosse-Kunstleve, P. D. Adams, M. D. Winn, L. C.
            Storoni and R. J. Read <A
            href="http://www.iucr.org/cgi-bin/paper?he5368"><I>J. Appl.
            Cryst.</I> <B>40</B>, 658-674 (2007)</A><BR></FONT></TD>
          <TD align=middle bgColor=#ffffff><A
            href="http://www.phenix-online.org/papers/he5368_reprint.pdf"
            target=_main><FONT face=Helvetica,Arial color=#000000
            size=2>[pdf]</FONT></A> </TD></TR>

        <TR id=mccoy2005>
          <TD align=left bgColor=#eeeee8><FONT face=Helvetica,Arial
            color=#000000 size=2><B>Likelihood-enhanced fast translation
            functions.</B> A.J. McCoy, R.W. Grosse-Kunstleve, L.C. Storoni &amp;
            R.J. Read <A href="http://www.iucr.org/cgi-bin/paper?gx5042"><I>Acta
            Cryst.</I> <B>D61</B>, 458-464 (2005)</A><BR></FONT></TD>
          <TD align=middle bgColor=#ffffff><A
            href="http://www.phenix-online.org/papers/gx5042_reprint.pdf"
            target=_main><FONT face=Helvetica,Arial color=#000000
            size=2>[pdf]</FONT></A> </TD></TR>
        <TR id=storoni2004>
          <TD align=left bgColor=#eeeee8><FONT face=Helvetica,Arial
            color=#000000 size=2><B>Likelihood-enhanced fast rotation
            functions.</B> L.C. Storoni, A.J. McCoy and R.J. Read. <A
            href="http://www.iucr.org/cgi-bin/paper?ad5007"><I>Acta Cryst.</I>
            <B>D60</B>, 432-438 (2004)</A><BR></FONT></TD>
          <TD align=middle bgColor=#ffffff><A
            href="http://www.phenix-online.org/papers/ad5007_reprint.pdf"
            target=_main><FONT face=Helvetica,Arial color=#000000
            size=2>[pdf]</FONT></A> </TD></TR>

        </TBODY>
     </TABLE>
    </TD>
  </TR>
  </TBODY>
</TABLE>


      <P><H5><U>Additional information</U></H5><P>


<!--REMARK PHENIX BODY END-->
