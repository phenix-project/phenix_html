<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Frequently asked questions for phenix.refine</U></H4>


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here.
Anything enclosed in header html H4 H5 etc will go in the table of contents>
<p>Note: questions specific to the GUI can be found in its
<a class="reference" href="refine_gui.htm">documentation</a>.</p>
<P><H5><U><B>General</B></U></H5><P>
<p><strong>How can I make phenix.refine run faster?</strong></p>
<p>There are currently two options for this:</p>
<blockquote>
<ul>
<li>compile from source with OpenMP support, which parallelizes the Fast
Fourier Transform (FFT) used in structure factor and gradient calculation</li>
<li>specify the 'nproc' parameter (or equivalent control in the GUI), which
parallelizes various grid searches by starting multiple Python jobs</li>
</ul>
</blockquote>
<p>The OpenMP parallelization is not particularly efficient, since the FFTs
take less than half of the typical runtime; a speedup of 40% is usually the
maximum.  The process-level parallelization with 'nproc' is most useful when
restraint weight optimization is enabled, since these procedures can be run
as multiple separate processes.  In these circumstances a speedup of 4-5x is
possible.  However, a run using default parameters will not significantly
benefit from setting 'nproc'.</p>
<p>There are several limitations to these options:</p>
<blockquote>
<ul>
<li>OpenMP support is incompatible with the Phenix GUI</li>
<li>'nproc' is incompatible with Windows</li>
<li>these approaches are incompatible with each other</li>
</ul>
</blockquote>
<p><strong>When should I use simulated annealing?</strong></p>
<p>Simulated annealing (SA) is most useful early in refinement, when the model
is far from convergence.  Manually built models, or MR solutions involving
significant local conformational changes, are common inputs where SA can
improve over simple gradient-driven refinement.  It is generally less helpful
later in refinement, and/or at high resolution.</p>
<p><strong>When should I use rigid-body refinement?</strong></p>
<p>This typically only needs to be performed once after molecular replacement,
unless you dock in additional domains later.  Continuing to use rigid-body
refinement in later runs will not improve your structure, and only adds to the
runtime.</p>
<p><strong>What type of experimental data should I use for refinement?</strong></p>
<p>Either amplitudes (F) or intensities (I) may be used in refinement (in any
file format), but intensities will be used preferentially.  Both anomalous and
non-anomalous data are supported; there does not appear to be any particular
benefit to model quality using one or the other with the default strategy.
However, anomalous data may be used to refine anomalous scattering factors
for heavy atoms, and anomalous difference map coefficients will automatically
be created in the output MTZ file.  For these reasons, anomalous data are
recommended.</p>
<p><strong>Why does phenix.refine not use all data in refinement?</strong></p>
<p>Reflections with abnormal values tend to reduce the performance of the
refinement engine.  These are identified based on several criteria (see
Read 1999 for details) and filtered out at the beginning of each macro-cycle.
You can prevent this by setting xray_data.remove_outliers=False.</p>
<p><strong>How many macro-cycles should I run?</strong></p>
<p>We recommend at least five to ensure convergence, but in some cases (especially
poorly refined structures) considerably more may be required for optimal
results.  (The default is three macro-cycles due to speed considerations.)</p>
<P><H5><U><B>Restraints</B></U></H5><P>
<p><strong>When should I optimize the geometry and/or B-factor restraint weights?</strong></p>
<p>This may be beneficial if the automatic weighting does not pick a good scale
for the X-ray and restraint terms; this will often be recognizable by
higher-than-expected bond and angle RMSDs.  In general it rarely hurts to
optimize the weights, and often results in a significantly better refinement,
but it is several times slower than ordinary refinement unless you have a
highly parallel system.  However, we strongly recommend weight optimization in
the final round of refinement, where it becomes essential to prevent
overfitting.</p>
<p><strong>How can I set the restraint weight manually?</strong></p>
<p>Our usual response is: don't do this manually, use the automatic optimization
instead.  Although this takes significantly longer to run, in practice most
users will spend an equivalent amount of time manually adjusting the weights
by trial-and-error.  If you are certain you need to have manual control, the
parameters fix_wxc (for geometry restraints) and fix_wxu (for B-factor
restraints) will set the weights.</p>
<p><strong>When should I use non-crystallographic symmetry (NCS) restraints?</strong></p>
<p>An approximate cutoff for NCS restraints is 2.0 Angstrom - at higher
resolution the data alone are usually sufficient, but at lower resolution
additional restraints are usually necessary.  This is somewhat subjective
due to the behavior of the global NCS restraints currently used by default in
PHENIX, but will be addressed in future versions.</p>
<p><strong>What is the difference between global and torsion NCS, and which one should
I pick?</strong></p>
<p>The global NCS restraints groups as rigid bodies, where all atoms in each
group are expected to be related to the others by a single rotation and
translation operation.  This does not respect local deformations in the
related molecules, which are common even at lower resolution.  The torsion
NCS restraints restraint dihedral angles instead, and allow them to be
unrestrained if genuinely different.  This will eventually become the default,
since it often results in significantly better refinement.</p>
<p><strong>Both NCS restraint types make my structure worse - what should I do?</strong></p>
<p>In most cases this is due to the restraint of B-factors between NCS groups,
which may actually have very different levels of disorder.
Setting the NCS B-factor weight term to zero usually fixes the problem.</p>
<p><strong>My resolution is X Angstroms; what should RMS(bonds) and RMS(angles) be?</strong></p>
<p>This is somewhat controversial, but absolute upper limits for a well-refined
protein structure at high resolution are typically 0.02 for RMS(bonds) and
2.0 for RMS(angles); usually they will be significantly lower.  As resolution
decreases the acceptable deviation from geometry restraints also decreases,
so at 3.5 Angstrom, more appropriate values would be 0.01 and 1.0.  We
recommend using the <a class="reference" href="validation.htm#polygon">POLYGON tool in the validation summary</a> to judge your structure relative to others at
similar resolutions.</p>
<p><strong>Why does my output model have very poor geometry (RMS(bonds) and
RMS(angles))?</strong></p>
<p>This usually means that the automatic X-ray/geometry weighting did not work
properly; this can sometimes happen if the starting model also has poor
geometry.  Optimizing the weight (optimize_xyz_weight=True, or equivalent
GUI control in the &quot;Refinement settings&quot; tab) will usually fix this problem.</p>
<p><strong>I have experimental phases for this structure, but the initial maps were
poor.  Should I still use phase restraints?</strong></p>
<p>The experimental phases
used to restraint refinement describe a bimodal probability distribution
for every angle, rather than the single values used to generate a map.  In
most cases the additional restraints will not hurt refinement, and can
often help.</p>
<p><strong>Why is phenix.refine messing up my ligand geometry?</strong></p>
<p>This often happens
when the restraints were generated using <a class="reference" href="ready_set.htm">ReadySet</a> from a
PDB file, and
the ligand code is not recognizable in the Chemical Components Database.
<a class="reference" href="elbow_gui.htm">eLBOW</a> will try to guess the molecular topology based on
the coordinates alone, but this is imprecise and may not yield the desired
result.  For best results, restraints for non-standard ligands should be
generated in eLBOW using a SMILES string or similar source of topology
information.</p>
<p><strong>What can I do to make my low-resolution structure better?</strong></p>
<p>In general, if NCS is present in your structure, you should always use NCS
restraints at low resolution; it is worth trying both the Cartesian (global)
and torsion restraints to see which works best for your model.  This alone
usually helps with the geometry and overfitting, although it is rarely
sufficient by itself.  There are also several different types of restraint
specifically designed to help with low-resolution refinement (consult the
full phenix.refine manual page for details on each):</p>
<blockquote>
<ul>
<li><strong>Reference model</strong>: this restraints the torsion angles to a
high-resolution model, using a potential that gently releases angles which
are genuinely different (allowing both local deformations or domain
movements).  This is usually the best option, and typically improves both
R-free, overfitting, and validation statistics.  However, it depends on
the availability of a suitable reference model.</li>
<li><strong>Secondary structure restraints</strong>: these are simply harmonic distance
restraints between hydrogen-bonding atoms in protein helices and sheets,
and nucleic acid base pairs.  Annotation can be either automatic or manual.
The primary limitation is currently the need for outlier filtering, which
removes spurious bonds but also some genuine ones.  It has a small effect
on validation statistics, and typically none on R-free, but it does keep
secondary structures stable.</li>
</ul>
</blockquote>
<p><strong>I have ions very close to water molecules/protein atoms, and phenix.refine
keeps tring to move them apart.  How can I prevent this?</strong></p>
<p>Use <tt class="docutils literal"><span class="pre">phenix.ready_set</span></tt> or <tt class="docutils literal"><span class="pre">phenix.metal_coordination</span></tt> to generate custom
bond (and optionally, bond angle) restraints, which will be output to a
parameter file ending in &quot;.edits&quot;.  If you are using the PHENIX GUI,
there is a toolbar button for ReadySet in the phenix.refine interface, which
will automatically load the output files for use in phenix.refine.</p>
<p><strong>I had previously generated custom restraints using ReadySet in the PHENIX
GUI, but the atoms have changed.  Now phenix.refine crashes because it can't
find the atom selections.  How do I remove the old custom restraints?</strong></p>
<p>In the Utilities menu, select &quot;Clear custom restraints.&quot;</p>
<P><H5><U><B>B-factors/ADPs/TLS</B></U></H5><P>
<p><strong>When should I use TLS?</strong></p>
<p>TLS refinement is generally valid at any resolution; at low resolution, it may
be best to make each chain a single group, instead of trying to split them
into smaller pieces.  However, it is best to wait until near the end of
refinement to add TLS; until then you should refine with isotropic ADPs only.</p>
<p><strong>Can I use both TLS and anisotropic ADPs?</strong></p>
<p>Yes, but not for the same atoms - since TLS is essentially constrained
anisotropic refinement, the two methods are mutually exclusive.</p>
<p><strong>Where is the switch for anisotropic vs. isotropic B-factors/ADPs?</strong></p>
<p>phenix.refine does not have a single global switch for defining ADP
parameterization; rather, when the &quot;Individual ADPs&quot; strategy is defined,
the program uses several criteria to determine how atoms should be
treated:</p>
<blockquote>
<ul>
<li>By default, atoms that are anisotropic in the input model (i.e. have
ANISOU records) will be kept anisotropic if the resolution is at least
1.7A; isotropic atoms remain isotropic.</li>
<li>If the resolution is lower, all atoms will be converted to isotropic
unless otherwise specified.</li>
<li>The atom selections for isotropic and anisotropic atoms may also be
defined explicitly.  Typically, the hydrogens will always be isotropic;
protein atoms will be anisotropic at high resolution, and sometimes
waters as well.</li>
</ul>
</blockquote>
<p>In the GUI, several common parameterizations are pre-defined in the dialog for
entering ADP selections.  Note that although it is possible to combine
all of the different ADP refinement strategies in a single run, the
atom selections for individual and grouped refinement may not overlap,
nor may the selections for anisotropic ADPs and TLS groups.</p>
<p><strong>When should I refine anisotropic ADPs instead of TLS groups?</strong></p>
<p>There is no precise cutoff where you should turn on anisotropic ADPs, but
these are approximate guidelines:</p>
<blockquote>
<ul>
<li>At 1.5 Angstrom resolution or better, refine protein/nucleic acid/ligand
heavy atoms (C/N/O or heavier) anisotropically, and waters isotropically.</li>
<li>At 1.2 Angstrom or better, waters should also be anisotropic.</li>
<li>It is almost never appropriate to refine hydrogens anisotropically.</li>
</ul>
</blockquote>
<p>There may be circumstances where anisotropic refinement is permissible at
slightly lower resolution, but 1.7 Angstrom is probably a lower limit.
Exceptions may sometimes be made for metal ions, since they scatter very
strongly.  As always, you should use the drop in R-free to judge whether the
change in parameterization was appropriate - a decrease of 0.5% (i.e. 0.005)
or better indicates success.</p>
<p><strong>When should I refine grouped B-factors/ADPs instead of individual?</strong></p>
<p>It is again difficult to give an exact rule, since it depends on several
properties of the crystal including resolution, solvent content, presence of
NCS, etc.  In general, the higher the data-to-parameter ratio, the more
likely individual ADPs are to work well.  As an approximate example, consider
these two hypothetical structures:</p>
<blockquote>
<ul>
<li>a 3.5 Angstrom structure of a single protein chain per asymmetric unit,
with 38% solvent content</li>
<li>a 4.0 Angstrom structure of 3 NCS-related chains, with 70% solvent
content</li>
</ul>
</blockquote>
<p>In this case, the latter structure can probably be refined with individual
ADPs, while the former is more marginal.  If in doubt, early rounds of
refinement may be done with grouped ADPs, switching to individual as the
structure nears convergence.  In general, it is usually worth trying
individual ADPs at some point; ultimately the effect on R-factors (primarily
R-free, but also the gap between R-work and R-free) is the most important
guideline.</p>
<P><H5><U><B>Interpreting results</B></U></H5><P>
<p><strong>My resolution is X Angstroms, and my R/R-free are Y and Z.  Am I done
refining?</strong></p>
<p>A partial answer can be obtained by looking at POLYGON, which
plots histograms of statistics for PDB structures solved at similar
resolutions, and compares these to the statistics for your output model.
As a general rule, R-factors alone should not be used to decide if a
structure is &quot;done&quot;, but should be examined in combination with the
validation report.</p>
<p><strong>My resolution is X Angstroms, the structure is complete and
well-validated, the maps look great, bu my R and R-free are still really
high.  How can I make them lower?</strong></p>
<p>There are several possible explanations for this:</p>
<blockquote>
<ul>
<li>Twinning with a relatively small twin fraction (perhaps 10%) may not
obviously affect map quality, but can still have a significant impact
on R-factors.  Run <a class="reference" href="xtriage_gui.htm">Xtriage</a> to look for evidence
of twinning, and possible twin laws for using in phenix.refine.  (Note
that we currently only support a single twin domain in refinement.)</li>
<li>Undiagnosed translational NCS (AKA translational pseudosymmetry) can
have a similar effect.  In this case, the diffraction images may have
been processed incorrectly, thus missing the fainter spots that result
from tNCS.  The program <a class="reference" href="http://cci.lbl.gov/labelit/">LABELIT</a>, or
more specifically the command <em>labelit.index</em> (distributed with
PHENIX, but not yet available in the GUI) can be run on the original
images to provide appropriate indexing parameters.</li>
</ul>
</blockquote>
<p><strong>The gap between R-work and R-free is very large - how can I fix this?</strong></p>
<p>Overfitting during refinement is usually helped by adding more restraints,
and/or tightening the standard geometry restraints.  If the output geometry
is already within reasonable limits (typically RMS(bonds) &lt; 0.016 and
RMS(angles) &lt; 1.8), ideas to try include adding NCS restraints if NCS is
present, secondary structure restraints, or reference model restraints (if
a high-resolution structure is available).  At lower resolutions (worse
than 3.0A), it may also be prudent to try grouped ADP refinement, and if
desperate, Ramachandran restraints.  TLS refinement can often improve
overfitting across a wide range of resolutions.  However, depending on the
degree of overfitting, it may be necessary to perform extensive manual
rebuilding first.  <em>(Note that if the large R/R-free gap suddenly appears
after refinement of a model that was previously not overfit, this usually
indicates incorrect parameterization of the refinement, e.g. using
anisotropic ADPs at an inappropriate resolution.)</em></p>
<P><H5><U><B>Hydrogens</B></U></H5><P>
<p><strong>When should I refine with hydrogens?</strong></p>
<p>This is largely a matter of personal preference.  Using explicit riding
hydrogen atoms can improve geometry at any resolution; at higher resolutions,
approximately 2 Angstrom or better, they will generally improve R-free as well.
At atomic resolution (1.5 A or better) they should always be part of the final
model.  Note that at unless you have true subatomic resolution (0.9 A or
better), the hydrogens should always be refined as &quot;riding&quot;, meaning that their
coordinates are defined by the heavy atoms, not individually refined.</p>
<p><strong>What about water molecules?</strong></p>
<p>Although phenix.ready_set includes an option to add hydrogens to waters, we
do not recommend this unless you have exceptionally high resolution and/or
neutron data.</p>
<p><strong>Why are my hydrogen atoms added by PHENIX exploding when I run real-space
refinement in Coot?</strong></p>
<p>Versions of Coot prior to 0.6.2 used a version of the CCP4 monomer library
with hydrogen atoms named
according to the PDB format version 2 standard; PHENIX can recognize these, but
defaults to PDB v.3.  To reconcile the different conventions, you can download
the newer version of the monomer library (currently available
<a class="reference" href="http://www.ysbl.york.ac.uk/~garib/refmac/data/refmac_experimental/refmac_dictionary_v5.29.tar.gz">here</a>) and set the environment variable
COOT_REFMAC_LIB_DIR to point to the directory in which you unpack it.</p>
<p><strong>Why can't PHENIX automatically remove hydrogens from the output PDB file?</strong></p>
<p>We strongly discourage removing any atoms used in refinement from the model,
as it makes reproducing the published R-factors very difficult and eliminates
essential information about how the structure was refined.</p>
<P><H5><U><B>Miscellaneous</B></U></H5><P>
<p><strong>How can I model a charged atom?</strong></p>
<p>The charge occupies columns 79-80 at the end of each ATOM or HETATM record,
immediately following the element symbol.  The format is the number of
electrons followed by the charge sign, for example &quot;1-&quot; or &quot;2+&quot;.  You can edit
the PDB file manually to add this, but we recommend using phenix.pdbtools:</p>
<blockquote>
phenix.pdbtools model.pdb charge_selection=&quot;element Mn&quot; charge=2</blockquote>
<p>This is also available in the GUI under &quot;Model tools&quot;.
The effect of setting the charge will be to use modified scattering factors
for X-ray refinement, which can be helpful if you notice difference density
appearing at ion sites.  Note that it will have no effect on the geometry,
since phenix.refine does not take electrostatics into account.</p>
<p><strong>I can't see density for an arginine sidechain beyond the C-gamma atom.  How
should I model it?</strong></p>
<p>Opinion in the crystallography differs on the proper approach to disordered
sidechains, with significant support for both of the following methods voiced
on the PHENIX and CCP4 mailing lists:</p>
<blockquote>
<ul>
<li>Delete all atoms not visible in density, but leave the residue name alone.
This is arguably the most conservative approach, as it avoids modeling any
features not supported by the data, and it is consistent with the
treatment of missing loops.  The main disadvantage is aesthetic,
since it is more difficult to visualize and interpret the biological
effects of a structure with missing sidechains.  Anecdotal evidence
suggests that some non-crystallographers may be confused by this.</li>
<li>Pick an appropriate rotamer, and let the B-factors rise to account for
disorder.  This avoids truncated sidechains that may be mistaken for other
residues, and is more realistic when interpreting surface electrostatics.
The atomic B-factors and coordinates are actually refined against the
data, however weak.  It is potentially dangerous because it implies a
greater level of confidence in these positions than is justified by the
data.  Additionally, the ADP restraints will keep the B-factors of nearby
atoms similar (within some tolerance), which is normally essential for
stable refinement but may artificially lower the B-factors of disordered
sidechains.</li>
</ul>
</blockquote>
<p>A third approach, setting the occupancy of missing atoms to zero but leaving
them in the model, is strongly disfavored, as the resulting positions and
B-factors are entirely theoretical (but not immediately obvious as such).</p>
<p><strong>Running phenix.model_vs_data (or the validation GUI) results in a slightly
different R-factor than reported in the PDB header by phenix.refine.  Shouldn't
these be the same?</strong></p>
<p>phenix.refine and phenix.model_vs_data use the same code to perform the bulk
solvent correction and scaling, so they should report approximately the same
R-factors given identical inputs.  The discrepancy arises when taking a PDB
file from refinement and running it back through phenix.model_vs_data.  Because
of the limited precision of the PDB format (three digits after the decimal
point for coordinates, two digits for B-factors and occupancy), the atomic
properties recorded in the PDB file will not be exactly the same as their
actual refined values.  In practice the difference in R-factors is
statistically insignificant, however.</p>
<P><H5><U><B>References</B></U></H5><P>
<blockquote>
<ul>
<li><p class="first"><em>phenix.refine</em> :
Afonine, P.V., Grosse-Kunstleve, R.W., Echols, N., Headd, J.J.,
Moriarty, N.W., Mustyakimov, M., Terwilliger, T.C., Urzhumtsev, A.,
Zwart, P.H. &amp; Adams, P.D. (2012) <strong>Towards automated crystallographic
structure refinement with phenix.refine</strong>
Acta Cryst. D68:352-367.</p>
<p>Afonine, P.V., Grosse-Kunstleve, R.W. &amp; Adams, P.D. (2005). CCP4 Newsl.
42, contribution 8.</p>
</li>
<li><p class="first"><em>Molprobity</em> :
Chen, V.B., Arendall III, W.B., Headd, J.J., Keedy, D.A.,
Immormino, R.M, Kapral, G.J., Murray, L.W., Richardson, J.S. &amp;
Richardson, D.C. (2010) <strong>MolProbity: all-atom structure validation for
macromolecular crystallography</strong>
<a class="reference" href="http://www.ncbi.nlm.nih.gov/pubmed/20057044">Acta Cryst. D66:12-21.</a></p>
<p>Davis IW, Leaver-Fay A, Chen VB, Block JN, Kapral GJ, Wang X, Murray LW,
Arendall WB 3rd, Snoeyink J, Richardson JS, Richardson DC.
<strong>MolProbity: all-atom contacts and structure validation for proteins
and nucleic acids.</strong>
<a class="reference" href="http://www.ncbi.nlm.nih.gov/pubmed/17452350">Nucleic Acids Res. 2007 35:W375-83.</a></p>
</li>
<li><p class="first"><em>POLYGON</em> :
Urzhumtseva L, Afonine PV, Adams PD, Urzhumtsev A.
<strong>Crystallographic model quality at a glance.</strong>
<a class="reference" href="http://www.ncbi.nlm.nih.gov/pubmed/19237753">Acta Cryst. 2009,  D65:297-300.</a></p>
</li>
</ul>
</blockquote>
<!--REMARK PHENIX BODY END-->
