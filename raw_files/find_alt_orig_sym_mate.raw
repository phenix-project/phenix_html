
<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>phenix.find_alt_orig_sym_mate: Identify equivalent MR solutions of the same dataset 
irrespective of origin and symmetry operation</U></H4> 


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here. 
Anything enclosed in header html H4 H5 etc will go in the table of contents>


<H5><U><B>Author(s)</B></U></H5>

<UL><LI>phenix.find_alt_orig_sym_mate: Robert D. Oeffner
<LI>PHENIX GUI: Nat Echols
</UL>

      
<H5><U>Purpose</U></H5>

For different molecular replacement (MR) solutions from the same dataset phenix.find_alt_orig_sym_mate.py
finds for each chain in the moving solution the copy closest to chains in the fixed solution with
respect to all symmetry operations and alternative origin shifts permitted by the spacegroup of the crystal.

<H5><U>Usage</U></H5>
phenix.find_alt_orig_sym_mate can be run from the command-line with PHIL input in either a text file or as keywords like
<PRE style="face=courier">
phenix.find_alt_orig_sym_mate.py moving_pdb=pdbfile1 fixed_pdb=pdbfile2
</PRE>
or
<PRE style="face=courier">phenix.find_alt_orig_sym_mate.py my_phil_input.txt.
</PRE>
The PHIL input specifies the MR solution files either as "moving_pdb" and "fixed_pdb"
or as the scopes, "moving" and "fixed". Both these scopes must hold
valid content. The two scopes hold the parameter "xyzfname" and the sub-scopes 
"mrsolution" and "pickle_solution". For a scope to be valid one and only of the 
methods (1), (2) and (3) must be followed:
<ol>
<LI> Assign the "moving_pdb" or "fixed_pdb" parameter to the pdb file from one of the MR solutions
in question. This is useful for simple cases such as when the solution comes from the
PHENIX AutoMR GUI is or when it is from a different MR program
other than Phaser.
</LI>
<LI>Specify a Phaser MR solution by assigning the file name
of the solution file to the "moving.mrsolution.solfname" or "fixed.mrsolution.solfname" parameter as well as assigning
the IDs of the ensembles and the corresponding MR models to the parameters
"moving.mrsolution.ensembles.name" or&nbsp; "fixed.mrsolution.ensembles.name" and
"moving.mrsolution.ensembles.xyzfname" or "fixed.mrsolution.ensembles.xyzfname"
respectively.
Multiple components are specified as multiple ensembles. This way of specifying
solutions is useful for solution files produced when Phaser is run from the
command line. 
</LI>
<LI>Use a solution from the PhaserMR GUI in PHENIX. In that case the parameter "moving.pickle_solution.pklfname"
or "fixed.pickle_solution.pklfname" is assigned to the solution file that is produced
by PHENIX after an MR calculation. The "moving.pickle_solution.philfname" or "fixed.pickle_solution.philfname"
is then
assigned to the input file for the MR calculation. This way of specifying
solutions is useful when MR solutions are available from having run Phaser
through the PHENIX interface. 
</LI>
</ol>

There is no restriction on what method to use for the fixed scope depending on the 
method used on the moving scope, and vice versa. If space group and the unit cell dimensions
is not available when for instance (2) is used for both the moving and the
fixed scopes then these need to be specified by assigning the parameter,
"spacegroupfname", to a PDB file with a CRYST1 record or to an MTZ file with
that information. Typically this would be the data file used for the molecular 
replacement calculation.


<H5>Examples of PHIL input</H5>

Unless the input just constitutes of two PDB files a PHIL file is the easiest way
to enter input. A few examples of PHIL for phenix.find_alt_orig_sym_mate are given
below.

<P><a name="anch10" id="Examples_of_PHIL_input_3"></a>

Testing a command-line Phaser MR solution file against a solution specified as a PDB file:

<PRE style="face=courier">
    AltOrigSymMates.fixed.mrsolution
    {
      solfname = "testdata/MR_3ECI_A0_2P82_A0.sol"
      ensembles
      {
        name = "MR_2P82_A0"
        xyzfname = "testdata/sculpt_2P82_A0.pdb"
      }
      ensembles
      {
        name = "MR_3ECI_A0"
        xyzfname = "testdata/sculpt_3ECI_A0.pdb"
      }
    }
    AltOrigSymMates.moving_pdb="testdata/2z0d.pdb"
</PRE>


<P><a name="anch11" id="Examples_of_PHIL_input_4"></a>

Testing two set of solution files from the PHENIX Phaser-MR GUI against one another:

<PRE style="face=courier">    AltOrigSymMates.fixed.pickle_solution
    {
      philfname = "testdata/phaser_mr_13.eff"
      pklfname = "testdata/phaser_mr_13.pkl"
    }
    
    AltOrigSymMates.moving.pickle_solution
    {
      philfname = "testdata/phaser_mr_11.eff"
      pklfname = "testdata/phaser_mr_11.pkl"
    }
</PRE>


<P><a name="anch12" id="Examples_of_PHIL_input_5"></a>

Testing two solution files from the command-line version of Phaser against one another:

<PRE style="face=courier">    AltOrigSymMates.fixed.mrsolution
    {
      solfname = "testdata/MR_3ECI_A0_2P82_A0.sol"
      ensembles
      {
        name = "MR_2P82_A0"
        xyzfname = "testdata/sculpt_2P82_A0.pdb"
      }
      ensembles
      {
        name = "MR_3ECI_A0"
        xyzfname = "testdata/sculpt_3ECI_A0.pdb"
      }
    }
    
    AltOrigSymMates.moving.mrsolution
    {
      solfname = "testdata/MR_2ZPN_A0_2P82_A0.sol"
      ensembles
      {
        name = "MR_2P82_A0"
        xyzfname = "testdata/sculpt_2P82_A0.pdb"
      }
      ensembles
      {
        name = "MR_2ZPN_A0"
        xyzfname = "testdata/sculpt_2ZPN_A0.pdb"
      }
    }
    AltOrigSymMates.spacegroupfname = "testdata/2Z0D.mtz"
</PRE>


<P>
For more information on the PHIL input see the bottom of this page.
</P>
<H5>Output</H5>
The closest match between chains in the moving section to chains in the fixed
section is saved with the name of the pdb file in
the fixed scope, concatenated with the name of the pdb file in the moving scope
but prepended with "MinMLAD_".
A log file with the name of the pdb file in the fixed scope, concatenated with the name
of the pdb file in the moving scope but prepended with "AltOrigSymMLAD_" is written
containing standard output.
All files are saved in the current working directory. If MR solutions specified in the PHIL contains multiple solutions then phenix.find_alt_orig_sym_mate
will output mulitple log files corresponding to each MR solution.

<H5>
Do the MR solutions match?
</H5>
A good match between two chains usually have a MLAD value below 1.5
whereas a bad match usually have a value above 2.0. This is a rule of thumb
and exceptions do occur. It is advisable to visually inspect that the structures superpose
one another in a molecular graphics viewing program.
If the structures contain more chains and phenix.find_alt_orig_sym_mate
did not place them all on the same origin a warning will be printed. 

<H5>Algorithm</H5>
phenix.find_alt_orig_sym_mate computes configurations by looping over all
symmetry operations and alternative origin shifts. 
An alignment between C-alpha atoms from moving_pdb and fixed_pdb is
computed using secondary structure matching (SSM). If that fails or if the MLAD score
achieved with SSM is larger than 2.0 an 
alignment is computed using MMTBX alignment functions which is part of the CCTBX.
To estimate the best match a distance measure between the aligned C-alpha atoms is
computed for each configuration. The <em>mean log absolute deviation</em> (MLAD) is
defined as:
<P>
MLAD(d<strong>R</strong>) = &#x3a3;( log(d<strong>r</strong>&#x0B7;d<strong>r</strong>/(|d<strong>r</strong>|
    + 0.9) + max(0.9, min(d<strong>r</strong>&#x0B7;d<strong>r</strong>,1)))),
</P>
<P>
</P>
where d<strong>r</strong> is the difference vector between a pair of aligned C-alpha atoms and the sum
is taken over all atom pairs in the alignment. MLAD is used as the distance measure.
MLAD will downplay the contributions of spatially distant C-alpha atom pairs which
may otherwise lead to incorrect matches when the space group has a floating origin
and the chains tested against one another consists of large unaligned domains.

phenix.find_alt_orig_sym_mate.py will for
each chain in the fixed scope find the smallest MLAD with a copy of each chain in 
the moving scope for a given symmetry operation and alternative origin. When all 
chains in the fixed scope have been tested these copies will be saved to a file. 

For spacegroups with floating origin the minimum MLAD is found
by doing a Golden Sectioning minimization along the polar axis for each copy
of chains in moving_pdb.

<H5>Debug mode</H5>
Invoking the debug flag produces individual pdb files of the C-alpha atoms used for
each SSM alignment of the moving scope for each permitted symmetry operation and alternative
origin. A gold atom is placed at the centroid of the C-alpha atoms. Similar files are
produced for the fixed scope. These files are stored in a subfolder named "AltOrigSymMatesFiles".
<P>
If a floating origin is present in the space group a table of MLAD values is produced by
sliding a copy of the chains in the moving scope along the polar axis in the fractional interval [-0.5, 0.5]
for each permitted symmetry operation and alternative origin.
</P>

<H5>Caveats</H5>
The program tests all solutions present in solution files entered as fixed scope 
against all solutions present in solution files entered as moving scope. Consequently the 
execution time is proportional to the number of solutions in fixed scope times the number of
solutions in moving scope.
<P>
The execution time is proportional to the number of SSM alignments being tested; if SSM 
identifies 12 alignments the program will take 12 times as long.
</P>


<H5>Changes</H5>
<P>
The command-line syntax mentioned in the Computational Crystallography Newsletter 2012 January
has been replaced by PHIL syntax.
</P>


<H5><U>Literature</U></H5>


<TABLE width=670 border=0>
  <TBODY>
  <TR>
    <TD>
      <TABLE cellSpacing=3 cellPadding=1 width="100%" align=center border=0>
        <TBODY>
        <TR id=article1>
          <TD align=left bgColor=eeeee8><FONT 
            color=000000 size=2><B>Algorithms for deriving crystallographic 
	    space-group information </B> R. W. Gro&#xDF;e-Kunstleve <A
            href="http://dx.doi.org/10.1107/S0108767398010186"><I>Acta Cryst.</I>
            <B>A55</B>, 383-395 (1999)</A><BR></FONT></TD>
	    </TR>
        <TR id=article1>
          <TD align=left bgColor=eeeee8><FONT 
            color=000000 size=2><B>phenix.find_alt_orig_sym_mate </B> 
            Robert D. Oeffner, G&#xE1;bor Bunk&#xF3;czi and Randy J. Read 
            <A href="http://www.phenix-online.org/newsletter/CCN_2012_01.pdf">
            <I>Computational Crystallography Newsletter 2012 January</I>,
            5-10 (2012)</A><BR></FONT></TD>
	    </TR>
        <TR id=article3>
          <TD align=left bgColor=eeeee8><FONT 
            color=000000 size=2><B>Secondary-structure matching (SSM), a new tool 
	    for fast protein structure alignment in three dimensions.
	    </B> E. Krissinel* and K. Henrick <A
            href="http://dx.doi.org/10.1107/S0907444904026460"><I>Acta Cryst.</I>
            <B>D60</B>, 2256-2268 (2004)</A><BR></FONT></TD>
	    </TR>
        </TBODY>
     </TABLE>
    </TD>
  </TR>
  </TBODY>
</TABLE>
      
<H5><U>Additional information</U></H5>



<!--REMARK PHENIX BODY END-->
