<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Using the LigandFit GUI</U></H4>


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here.
Anything enclosed in header html H4 H5 etc will go in the table of contents>
<P><H5><U><B>Overview</B></U></H5><P>
<p>LigandFit is one of the four PHENIX &quot;wizards&quot; for automated structure
determination.  It performs flexible ligand fitting into difference maps
using RESOLVE, followed by optional real-space refinement.  As elsewhere, this
documentation covers the use of the GUI specifically, and is not a
general-purpose reference for program function.  See the <a class="reference" href="ligandfit.htm">command-line
documentation</a> for a complete list of parameters and details
on usage.</p>
<p>Note that waters will be omitted when placing the ligand.  However, if you
are using pre-calculated map coefficients, you may need to remove waters
beforehand to avoid &quot;flattening&quot; the difference density around the ligand.
Protein atoms overlapping with the ligand density will prevent a successful
placement, so some editing of the input structure is generally recommended.</p>
<P><H5><U><B>Configuration</B></U></H5><P>
<p>The first tab in the LigandFit window contains a field for adding input files,
which can be dragged and dropped from the desktop, or picked from a file
browser by clicking the &quot;+&quot; button.</p>
<div class="image"><img alt="images/ligandfit_config.png" src="images/ligandfit_config.png" /></div>
<p>To run, you will need the following input files:</p>
<blockquote>
<ul>
<li>A PDB file containing the initial ligand-free model.  (It is okay for this
to contain previously-placed ligands as long as the intended binding site
is empty.)  Water molecules will be automatically removed if necessary.</li>
<li>An MTZ file containing either experimental amplitudes (F,SIGF) or
pre-calculated difference map coefficients.</li>
<li>A file describing your ligand.  This should be either a PDB file containing
a single residue, or a text file containing a SMILES string.  In the
latter case, eLBOW will be used to generate the starting geometry.</li>
</ul>
</blockquote>
<p>Additional optional files:</p>
<blockquote>
<ul>
<li>A PDB file containing ligand coordinates for comparison at the end of
the program.</li>
<li>A PDB file containing previously fit ligands (in addition to the starting
model), which will be used to exclude occupied regions from fitting.</li>
<li>CIF files defining ligand restraints for refinement.</li>
<li>A reflections file containg F/I, SIGF/SIGI, and FreeR_flag for running
a full round of phenix.refine after fitting.</li>
</ul>
</blockquote>
<p>Ligandfit will try to guess what each input file should be used for
automatically.  If it does not choose the desired data type, you can change
this by right-clicking the &quot;Data type&quot; column for that file, or selecting
the file and clicking the &quot;Modify file data type&quot; button below the list.</p>
<div class="image"><img alt="images/ligandfit_file_type.png" src="images/ligandfit_file_type.png" /></div>
<p>MTZ column labels (and map type, if applicable) will be extracted automatically
when a file is loaded.</p>
<p>By default, LigandFit runs multiple slightly different jobs in parallel and
picks the best result from these; however, check the &quot;Quick search&quot; box if
you want it to run a fast single job instead.</p>
<p>Other options:</p>
<blockquote>
<ul>
<li><strong>Ligand map type</strong> tells LigandFit what type of map to calculate or
expect in the input file.  If you are supplying map coefficients from
phenix.refine or another program, &quot;Pre-calculated&quot; is appropriate.  If
you are using raw data, &quot;Fo-Fc&quot; is the standard, but you may use &quot;Fobs&quot;
instead.</li>
<li><strong>Minimum CC</strong> sets the correlation to density required to consider a
placement successful.</li>
<li><strong>Real-space refinement</strong> will optimize the fit to density after placing
the ligand.  This is optional (and may be unnecessary if you intend to
run phenix.refine immediately afterward), but is usually very fast and
improves the fit.</li>
<li><strong>Number of conformers to create</strong> determines how the ligand is partitioned
for placement of fragments.  When this is set to 1, RESOLVE will try to
identify rigid groups automatically.  Larger numbers will instead use
eLBOW to generate multiple conformations which are used to identify the
rigid groups.  This is somewhat slower, but often more accurate.</li>
</ul>
</blockquote>
<P><H5><U><B>Running the program</B></U></H5><P>
<p>Unless quick mode is enabled, LigandFit typically works by starting multiple
similar jobs with slightly different parameters, to sample as many candidate
ligand conformations and density fits as possible.  Although this increases
runtime substantially, it parallelizes well across multiple CPUs if they are
available, and a queuing system may be utilized to split up tasks.</p>
<p>Depending on how you have configured your computer and
your Phenix installation, as well as the operating system used, you may
have several options for starting LigandFit:</p>
<blockquote>
<ul>
<li>Run locally; this is the default mode (and on Windows, the only
mode), and offers the best integration with the GUI, but has the
limitation that the GUI may not be closed while the program is running.</li>
<li>Run &quot;detached&quot;: this starts a completely separate process, which will
allow you to close the GUI and resume later.  (Not available on Windows.)</li>
<li>Run on a queuing system: this is usually only available on Linux, and
requires that queuing support be enabled in the GUI preferences.
Currently Sun Grid Engine is the prefered system, although PBS can be
made to work with some customization.  <strong>If you use this option, be sure
to set the number of processors to 1, or the job may interfere with
other processes on the queuing system.</strong></li>
</ul>
</blockquote>
<p>Additionally, if queuing system support is enabled, the GUI will also present
an option to distribute the individual jobs across the queue.  If this option
is selected, either local or detached mode should be used, and the primary job
will be run locally, with child processes submitted to the queue.</p>
<P><H5><U><B>Output</B></U></H5><P>
<p>LigandFit will generate a difference map used for fitting, and a separate PDB
file for each copy placed.  All of these can be opened at once in one of
the graphics programs by clicking the buttons next to the file list.  The
button labeled &quot;Run phenix.refine&quot; will launch that GUI with the start model,
reflections (if amplitudes were supplied), and all ligand output files already
loaded.</p>
<div class="image"><img alt="images/ligandfit_summary.png" src="images/ligandfit_summary.png" /></div>
<p>As a general rule, a correlation coefficient (CC) above 0.7 is considered a
good fit; CCs below this value usually indicate that the ligand is not placed
correctly (although in rare cases the fit may be partially correct).  In any
case, you should always visually inspect the ligand placement in Coot, both
before and after refinement.  If LigandFit was unable to place the ligand
correctly, there are several recommendations for troubleshooting:</p>
<p>If you do not obtain a good fit of your ligand to the map, there are a few things you should check:</p>
<blockquote>
<ul>
<li>Does your starting model have other molecules where the ligand needs to be
placed? If so, then you will need to remove these before LigandFit can fit
the ligand there. The LigandFit Wizard excludes all locations that are
occupied by atoms in the starting model.  <strong>Note that waters are the
exception to this rule, and will be ignored as necessary - however, if
you are fitting to an Fo-Fc difference map, the presence of waters may
obscure ligand density.</strong></li>
<li>Have a careful look at all the output files. Work your way through the main
log file (e.g., LigandFit_run_1_1.log). Is there anything strange or
unusual in any of them that may give you a clue as to what to try next?</li>
<li>Have a look at the difference electron density map. Does it have clear
density for the ligand? If not, you may want to try other types of maps.
You can run <a class="reference" href="create_maps.htm">phenix.maps</a> to obtain a sigmaA-weighted
mFo-DFc map that should optimally show the placement of your ligand.</li>
<li>If you have atomic-resolution data, try setting the high-resolution limit
slightly lower; data beyond approximately 1.8A rarely improve the fit, and
may actually make it more difficult.</li>
</ul>
</blockquote>
<P><H5><U><B>References</B></U></H5><P>
<blockquote>
<ul>
<li>CITATION:ligand_fit</li>
<li>CITATION:ligand_id</li>
</ul>
</blockquote>
<!--REMARK PHENIX BODY END-->
