
<!--REMARK PHENIX TITLE START  Put your title here>


<H4><U>Automated ligand identification</U></H4> 


<!--REMARK PHENIX TITLE END-->

<!--REMARK PHENIX BODY START   Put your text here. 
Anything enclosed in header html H4 H5 etc will go in the table of contents>


      <P><H5><U><B>Author(s)</B></U></H5><P>
<UL><LI>phenix.ligand_identification: Li-Wei Hung
<LI>PHENIX GUI and PDS Server: Nigel W. Moriarty,Nathaniel Echols
<LI>RESOLVE: Tom Terwilliger
</UL>

      <P><H5><U>Purpose</U></H5><P>

<P><H5>Purpose of the phenix.ligand_identification command</H5><P>

<P>The phenix.ligand_identification command carries out fitting of a library of <a href="ligand_identification.htm#anch70">180 most frequently observed ligands</a> in the PDB  to a given electron density map. The program also conducts the analysis and ranking of the ligand fitting results.  

<P>The phenix.ligand_identification command works with the ligand library provided with the Phenix program by default.  It can also take a <a href="ligand_identification.htm#anch25">custom ligand library</a> provided by the users.  





      <P><H5><U>Usage</U></H5><P>
<P>The phenix.ligand_identification task can be run from <a href="ligand_identification.htm#anch45">command line</a>, or from the PHENIX GUI. 
<P>
<P><H5>How the phenix.ligand_identification works:</H5><P>
<P>
<P>The phenix.ligand_identification command uses RESOLVE ligand fitting methods as described in the <a href="ligandfit.htm">LigandFit documentation.</a> The phenix.ligand_identification carries out this fitting process for a library of <a href="ligand_identification.htm#anch70">180 most frequently observed ligands</a> in the Protein Data Bank, or a custom library as described above, scores and ranks the overall fitting results.  A real-space refinement is carried out on the ligand by default between RESOLVE fitting and Phenix scoring.  The scoring algorithm takes into consideration of density correlation between ligand and density as well as non-bonded interactions between fitted ligand and the input model. The output consists of a list of the best fitted ligands from the library.  The command provides options to view the top ranked ligand in coot with or without the electron density (use keyword "--open_in_coot=True").   



<P><H5>How to run the phenix.ligand_identification </H5><P>
<P>  Example commands are provided below.  The nsf-d2 files are in $PHENIX/phenix_examples/nsf-d2-ligand


<P><H5>What the phenix.ligand_identification command needs to run:</H5><P>

    The phenix.ligand_identification command needs:
<P><UL>(1) a mtz file containing structure factors
<P>(2) (optional), a PDB file with your protein model without ligand

<P><H5><I>Choice of ligand library </I>(keywords+examples)</H5><P> 

<P>*<a href="ligand_identification.htm#anch70">default ligand library</a>: 
  no keyword needed

<P>*to specify a list of ligands in 3-letter codes:
<PRE style="face=courier">--ligand_list="ATP CTP TTP GTP"  </PRE>

<P>*to use all small molecules with a .pdb extension in the 'ligand_dir' as the search library:
<PRE style="face=courier">--ligand_dir=/my/compound/library/A1217321
</PRE>

<P>*to use all ligands associated with proteins of specific function found in the PDB as the search library:  
<PRE style="face=courier">--function="tyrosine kinase"
</PRE>


<P>*to use all ligands found in proteins with a specific Enzyme Classification number in the PDB:
<PRE style="face=courier">--EC=1.1.1.3
</PRE>


<P>*to use all ligands found in proteins with a specific Pfam accession number in the PDB:
<PRE style="face=courier">--pfam=PF00042
</PRE>


<P>*to use all ligands found in proteins with specific SCOP and/or CATH terms in the PDB:
<PRE style="face=courier">--scop='DNA/RNA-binding 3-helical bundle' 
</PRE>
<PRE style="face=courier">--cath='Trypsin-like serine proteases'  
</PRE>


<P>*to use all ligands found in proteins with a specific Gene Ontology (GO) accession number in the PDB:
<PRE style="face=courier">--GO=0009253
</PRE>


<P>*to use all ligands found in proteins with a specific InterPro ID in the PDB:
<PRE style="face=courier">--ipro=014838
</PRE>


<P><H5><I>Output files from phenix.ligand_identification command</I></H5><P>
<P>When you run phenix.ligand_identification command, the output files will be in the directory you started Phenix:

<P><LI> A summary file of the fitting results of all ligands:
<PRE style="face=courier">overall_ligand_scores.log
</PRE>

<P><LI> A summary table listing the results of the top ranked ligands:
<PRE style="face=courier">topligand.txt
</PRE>
<P>The last column "Sequence in library' contains numbers '###' indicating the sequence number of  the corresponding ligands.  The final fitted ligand coordinates and all the log files are in the corresponding'###' files described below.

<P><LI>PDB files with the fitted ligands:
<PRE style="face=courier">ligand_fit_pdbs/RSR_FITTED_[3-letter code]_###.pdb
</PRE>

<P><LI>Resolve fitting Score files:
<PRE style="face=courier">ligand_fit_scores/[3-letter code].scores
</PRE>

<P><LI>Map coefficients for the map used for fitting:
<PRE style="face=courier">resolve_map.mtz
</PRE>

<P><LI>Command file to display results in coot:
<PRE style="face=courier">display.com (uses ligid.scm, also in the same directory)
</PRE>
</UL>

<P><H5>Multi-thread computing </H5><P>
<P> The phenix.ligand_identification program has build-in multi-thread processing capability. Use keyword
<PRE style="face=courier">--nproc=[number of threads] 
</PRE>
to run the command in multi-threaded mode.  In general, the processing speed is proportional to the the number of threads used, up to the maximum free cores the system can allocate at run time. For example, it takes about 25 minutes for the nsf-d2 example to run in 8 threaded mode, while single-process uses about 180 minutes for the same job on a dual-Xeon W5580 machine.

     <P><H5><U>Running from a parameters file</U></H5><P>
<P>You can run phenix.ligand_identification from a parameters file. This is often convenient because you can generate a default one with: 
<PRE style="face=courier">phenix.ligand_identification --show_defaults > my_ligand.eff
</PRE>
and then you can just edit this file to match your needs and run it with: 
<PRE style="face=courier">phenix.ligand_identification  my_ligand.eff
</PRE>


      <P><H5><U>Examples</U></H5><P>
<P><H5> Sample command_line inputs</H5><P>

<P><UL><LI>Standard run of ligand_identification (input protein model and data file, default ligand library, 8 CPUs)
<PRE style="face=courier">phenix.ligand_identification mtz_in=nsf-d2.mtz model=nsf-d2_noligand.pdb \
 input_labels=F nproc=8\   
</PRE>

<P><LI>Search ligand from a difference map or pre-calculated map coefficients from phenix.refine
<P>If your refine a model with a command such as,
<PRE style="face=courier">phenix.refine data.mtz partial.pdb
</PRE>
then you will end up with the refined model,
<PRE style="face=courier">partial_refine_001.pdb
</PRE>
and a map coefficients file:
<PRE style="face=courier">partial_refine_001_map_coeffs.mtz
</PRE>
You can then run ligand_identification using the 2Fo-Fc map calculated from these map
coefficients:

<PRE style="face=courier">phenix.ligand_identification mtz_type=diffmap \ mtz_in=partial_refine_001_map_coeffs.mtz  input_labels="2FOFCWT PH2FOFCWT" \
model=partial_refine_001.pdb nproc=8
</PRE>
For Fo-Fc map from the same file you can say:
<PRE style="face=courier">phenix.ligand_identification mtz_type=diffmap \ mtz_in=partial_refine_001_map_coeffs.mtz  input_labels="FOFCWT PHFOFCWT" \
model=partial_refine_001.pdb nproc=8
</PRE>
In the above two cases, "model" keyword is optional.  If provided, non-bonded terms will be used in scoring. 


<P>The examples below show various ways of specifying custom ligand libraries based on the 'standard run' example above.
<P><LI>Identify ligand from a series of ligands in 3-letter codes
<PRE style="face=courier">phenix.ligand_identification mtz_in=nsf-d2.mtz model=nsf-d2_noligand.pdb \
 input_labels=F ligand_list="ATP GTP CTP TTP ADP GDP CDP TDP A3P GSP NAP AMP GMP CMP TMP"
</PRE>

<P><LI>Identify ligand from a given set of pdb files (could be your compound library) in a specific directory
<PRE style="face=courier">phenix.ligand_identification mtz_in=nsf-d2.mtz model=nsf-d2_noligand.pdb \
 input_labels=F ligand_dir=/my/compound/library/A1217321
</PRE>
This command will take all .pdb files in the ligand_dir and a make a custom library to carry out the search

<P><LI>Identify ligand from a library composed of all ligands found in Tyrosine kinases in the PDB
<PRE style="face=courier">phenix.ligand_identification mtz_in=nsf-d2.mtz model=nsf-d2_noligand.pdb \
 input_labels=F function="Tyrosine kinase"
</PRE>
This command could be useful when you want to use a function-specific ligand library. The 'function' should be in one of the EC terms.  Note in the above example, if only "kinase" is specified, ligand found in all types of kinases will be searched.


<P><LI>Identify ligand from a library composed of all ligands found in proteins belong to a specific Enzyme Classification
<PRE style="face=courier">phenix.ligand_identification mtz_in=nsf-d2.mtz model=nsf-d2_noligand.pdb \
 input_labels=F EC=1.1.3
</PRE>
This command could be useful when you want to use a function-specific ligand library, and your protein belongs to a EC.  Note the EC can be any parent set of the actual EC. (e.g. you can use 1.1.3 instead of 1.1.3.1 although you'll get a boarder library with EC=1.1.3).




</UL>

<P>  The nsf-d2 files in the above examples can be found in $PHENIX/phenix_examples/nsf-d2-ligand

      <P><H5><U>Possible Problems</U></H5><P>

<P><H5>Specific limitations and problems:</H5><P>

<P><UL><LI>The current Resolve_ligand_identification task work with the ligand library provided with the Phenix program by default.  It is also capable of fitting and ranking ligands in a custom PDB library provided by the users.  The ligand atoms in the user-provided PDBs should be under 'HETATM' records.

<P><LI> Other Resolve related limitations please refer to the document of the <a href="ligandfit.htm">LigandFit wizard.</a>



</UL>

<P><H5><U>Literature</U></H5><P>
<TABLE width=670 border=0>
  <TBODY>
  <TR>
    <TD>
      <TABLE cellSpacing=3 cellPadding=1 width="100%" align=center border=0>
        <TBODY>

        <TR id=terwilliger2007a>
          <TD align=left bgColor=eeeee8><FONT 
            color=000000 size=2><B>Ligand identification using electron-density
            map correlations.</B> T. C. Terwilliger, P. D. Adams, N. W. Moriarty
            and J. D. Cohn <A
            href="http://www.iucr.org/cgi-bin/paper?ba5092"><I>Acta Cryst.</I>
            <B>D63</B>, 101-107 (2007)</A><BR></FONT></TD>
          <TD align=center bgColor=ffffff><A
            href="http://www.phenix-online.org/papers/ba5092_reprint.pdf"
            target=_main><FONT  color=000000
            size=2>[pdf]</FONT></A> </TD></TR>
        <TR id=terwilliger2006>
          <TD align=left bgColor=eeeee8><FONT 
            color=000000 size=2><B>Automated ligand fitting by core-fragment
            fitting and extension into density.</B> T. C. Terwilliger, H. Klei,
            P. D. Adams, N. W. Moriarty and J. D. Cohn <A
            href="http://www.iucr.org/cgi-bin/paper?dz5066"><I>Acta Cryst.</I>
            <B>D62</B>, 915-922 (2006)</A><BR></FONT></TD>
          <TD align=center bgColor=ffffff><A
            href="http://www.phenix-online.org/papers/dz5066_reprint.pdf"
            target=_main><FONT  color=000000
            size=2>[pdf]</FONT></A> </TD></TR>

        </TBODY>
     </TABLE>
    </TD>
  </TR>
  </TBODY>
</TABLE>

<P><H5><U>Additional information</U></H5><P>

<P><H5>List of ligands in the PHENIX ligand_identification default library</H5><P>
<P>---------------------------------------------------------------

      
<PRE style="face=courier">
 PG4
 CRY
 CYS
 DIO
 DOX
 GOL
 MO5
 NBN
 OXL
 OXM
 PUT
 PYR
 F3S
 MO6
 PEG
 COA
 DTT
 FS4
 HED
 HEZ
 LI1
 MPD
 SF4
 SIN
 TMN
 TRS
 URA
 BEN
 BEZ
 MET
 NIO
 PGA
 POP
 ASP
 DAO
 FSO
 FUC
 GLU
 LYS
 PEP
 PGE
 PHB
 PHQ
 PLM
 TAR
 XYS
 ADE
 AKG
 7HP
 BGC
 CAM
 HC4
 ORO
 DKA
 GAL
 GLC
 MAN
 MES
 ARG
 PHE
 CIT
 FLC
 MMA
 MPO
 MYR
 NHE
 OLA
 PG4
 AMG
 FER
 NAA
 NAG
 NDG
 SPM
 EPE
 NGA
 PLP
 TRP
 BTN
 F6P
 FTT
 G6P
 LDA
 UPL
 1PE
 BH4
 H4B
 THM
 1PG
 P6G
 U10
 ADN
 BOG
 EST
 FBP
 GSH
 GTT
 NVP
 RET
 UMP
 C5P
 C8E
 DHT
 TMP
 UFP
 CMP
 NCN
 PRP
 BGC
 MAN
 GTS
 IMP
 LAT
 MAL
 SUC
 GLC
 AMP
 FPP
 PQQ
 T44
 2GP
 3GP
 5GP
 TYD
 UDP
 GTX
 SAH
 TDP
 TPP
 IMO
 SAM
 A3P
 ADP
 DCP
 GDP
 NAG
 XYS
 2PE
 CTP
 DAD
 FOK
 TTP
 DTP
 DGA
 FMN
 SAP
 ACP
 ANP
 APC
 ATP
 FOL
 GNP
 GSP
 GTP
 MTX
 MAN
 CB3
 MA4
 UPG
 UD1
 SPO
 HEC
 HEM
 NAG
 NAD
 NAI
 ACR
 GLC
 NAP
 NDP
 DHE
 BPH
 ACO
 BCL
 FAD
 CAA
 GLC
 AP5
 BPB
 B12

</PRE>


<!--REMARK PHENIX BODY END-->
